<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Job Description Creator</title>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body{
      background: linear-gradient(135deg, #071326, #0c1f33, #111c2b, #1c1f2b);
      min-height:100vh;
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color:#fff;
      line-height:1.6;
    }
    .container{
      max-width:1200px;
      margin:40px auto;
      padding:30px 20px 60px 20px;
      background: linear-gradient(160deg, rgba(8,20,38,0.85), rgba(10,30,55,0.75));
      border-radius:24px;
      box-shadow:0 25px 70px rgba(0,0,0,0.4);
    }
    .header{ text-align:center; margin-bottom:22px; }
    .header h1{ font-size:2.3em; margin-bottom:8px; }
    .header p{ opacity:.9; }

    .card{
      background: rgba(10,20,38,0.85);
      border-radius:22px;
      box-shadow:0 25px 55px rgba(0,0,0,0.45);
      padding:26px;
      margin-bottom:18px;
      backdrop-filter: blur(12px);
      border:1px solid rgba(66,165,245,0.25);
    }

    .section-title{
      text-align:center;
      margin-bottom:18px;
      font-size:1.4em;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-weight:700;
      color:#e3f2fd;
      position:relative;
    }
    .section-title::after{
      content:'';
      display:block;
      width:90px;
      height:4px;
      border-radius:999px;
      margin:12px auto 0;
      background: linear-gradient(90deg, #64b5f6, #42a5f5, #1e88e5);
      box-shadow:0 0 12px rgba(66,165,245,0.5);
    }

    .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:14px; }
    .field label{ display:block; margin:0 0 6px 0; font-weight:600; color:#e3f2fd; font-size:.95em; opacity:.95; }
    .input, .textarea, .select{
      width:100%;
      border:1px solid rgba(255,255,255,0.25);
      border-radius:10px;
      padding:12px 12px;
      background: rgba(255,255,255,0.16);
      color:#fff;
      outline:none;
      font-size:14px;
    }
    .textarea{ min-height:110px; resize:vertical; }
    .input::placeholder, .textarea::placeholder{ color:rgba(255,255,255,0.65); }
    .input:focus, .textarea:focus, .select:focus{
      border-color: rgba(66,165,245,0.6);
      box-shadow:0 0 10px rgba(66,165,245,0.3);
    }

    .btn-row{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      justify-content:center;
      margin-top:14px;
    }
    .btn{
      border:none;
      padding:14px 18px;
      border-radius:10px;
      cursor:pointer;
      font-size:15px;
      font-weight:700;
      color:#fff;
      transition: all .25s ease;
      min-width: 220px;
    }
    .btn.primary{ background: linear-gradient(45deg, #0b4f6c, #1976d2); }
    .btn.secondary{ background: linear-gradient(45deg, #4caf50, #45a049); }
    .btn.ghost{ background: rgba(255,255,255,0.14); border:1px solid rgba(255,255,255,0.20); }
    .btn:hover:not(:disabled){ transform: translateY(-2px); }
    .btn:disabled{ opacity:.6; cursor:not-allowed; }

    .error{
      margin-top:14px;
      padding:14px;
      background: rgba(244, 67, 54, 0.2);
      border:1px solid rgba(244, 67, 54, 0.5);
      border-radius:10px;
      color:#ff8a80;
      display:none;
    }

    .results{ display:none; }
    .results.show{ display:block; animation: fadeIn .5s ease-in; }
    @keyframes fadeIn{ from{ opacity:0; transform: translateY(16px); } to{ opacity:1; transform: translateY(0); } }

    .panel{
      margin-top:14px;
      background: rgba(7,17,32,0.88);
      border-radius:14px;
      border-left:6px solid #42a5f5;
      box-shadow:0 18px 38px rgba(0,0,0,0.45);
      padding:18px;
    }

    .toggle{
      width:100%;
      background:transparent;
      border:none;
      color:#fff;
      cursor:pointer;
      display:flex;
      justify-content:space-between;
      align-items:center;
      text-align:left;
      padding:0;
    }
    .toggle h3{ margin:0; font-size:1.05em; }
    .icon{ font-size:1.1em; min-width:20px; text-align:center; transition: transform .2s ease; }
    .body{ margin-top:12px; display:none; }
    .body.open{ display:block; }

    .mono{
      white-space:pre-wrap;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:13px;
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.12);
      padding:14px;
      border-radius:12px;
    }

    @media (max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
      .btn{ min-width: unset; flex:1; }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>AI Job Description Creator</h1>
      <p>Create polished, ATS-friendly job descriptions + auto-fill from web research</p>
    </div>

    <div class="card">
      <h2 class="section-title">Job Inputs</h2>

      <div class="grid">
        <div class="field">
          <label>Job Title *</label>
          <input class="input" id="jobTitle" placeholder="e.g., Risk Governance Lead" />
        </div>

        <div class="field">
          <label>Starter Mode</label>
          <select class="select" id="starterMode">
            <option value="none" selected>None</option>
            <option value="paste">Extract from pasted job text</option>
            <option value="web">Search the internet (job title)</option>
          </select>
        </div>

        <div class="field">
          <label>Company</label>
          <input class="input" id="company" placeholder="e.g., Career Solutions for Today" />
        </div>

        <div class="field">
          <label>Location</label>
          <input class="input" id="location" placeholder="e.g., Phoenix, AZ (Hybrid)" />
        </div>

        <div class="field">
          <label>Employment Type</label>
          <select class="select" id="employmentType">
            <option value="Full-time">Full-time</option>
            <option value="Part-time">Part-time</option>
            <option value="Contract">Contract</option>
            <option value="Temporary">Temporary</option>
            <option value="Internship">Internship</option>
          </select>
        </div>

        <div class="field">
          <label>Seniority</label>
          <select class="select" id="seniority">
            <option value="Entry">Entry</option>
            <option value="Mid">Mid</option>
            <option value="Senior" selected>Senior</option>
            <option value="Lead">Lead</option>
            <option value="Manager">Manager</option>
            <option value="Director">Director</option>
          </select>
        </div>
      </div>

      <div class="field" style="margin-top:14px;">
        <label>Paste Job Posting Text (for LinkedIn / any site)</label>
        <textarea class="textarea" id="jobPaste" placeholder="Copy/paste the job description here (optional)..."></textarea>
      </div>

      <div class="btn-row">
        <button class="btn ghost" id="extractBtn">ðŸ§² Extract Starter Info</button>
      </div>

      <div class="grid" style="margin-top:14px;">
        <div class="field">
          <label>Must-have Skills (comma-separated)</label>
          <textarea class="textarea" id="mustSkills" placeholder="e.g., Excel, SQL, governance, stakeholder mgmt"></textarea>
        </div>

        <div class="field">
          <label>Nice-to-have Skills (comma-separated)</label>
          <textarea class="textarea" id="niceSkills" placeholder="e.g., Power BI, Python, Jira, AWS"></textarea>
        </div>
      </div>

      <div class="grid" style="margin-top:14px;">
        <div class="field">
          <label>Key Responsibilities (bullet ideas)</label>
          <textarea class="textarea" id="responsibilities" placeholder="e.g., Partner with stakeholders, build dashboards..."></textarea>
        </div>

        <div class="field">
          <label>About the Team / Mission</label>
          <textarea class="textarea" id="teamMission" placeholder="What does the team do and why does it matter?"></textarea>
        </div>
      </div>

      <div class="grid" style="margin-top:14px;">
        <div class="field">
          <label>Tone</label>
          <select class="select" id="tone">
            <option value="Professional" selected>Professional</option>
            <option value="Warm">Warm</option>
            <option value="Bold">Bold</option>
            <option value="Startup">Startup</option>
            <option value="Enterprise">Enterprise</option>
          </select>
        </div>

        <div class="field">
          <label>Length</label>
          <select class="select" id="length">
            <option value="Concise">Concise</option>
            <option value="Standard" selected>Standard</option>
            <option value="Detailed">Detailed</option>
          </select>
        </div>
      </div>

      <div id="error" class="error"></div>

      <div class="btn-row">
        <button class="btn primary" id="generateBtn">âœ¨ Generate Job Description</button>
        <button class="btn secondary" id="copyBtn">ðŸ“‹ Copy JD</button>
      </div>
    </div>

    <div class="card results" id="results">
      <h2 class="section-title">Results</h2>

      <div class="panel">
        <button class="toggle" onclick="togglePanel('jd')">
          <h3>âœ… Generated Job Description</h3>
          <span class="icon" id="jd-icon">â–¶</span>
        </button>
        <div class="body" id="jd">
          <div class="mono" id="jdText"></div>
        </div>
      </div>

      <div class="panel">
        <button class="toggle" onclick="togglePanel('keywords')">
          <h3>ðŸ§  ATS Keywords</h3>
          <span class="icon" id="keywords-icon">â–¶</span>
        </button>
        <div class="body" id="keywords">
          <div class="mono" id="keywordsText"></div>
        </div>
      </div>

      <div class="panel">
        <button class="toggle" onclick="togglePanel('sources')">
          <h3>ðŸ”— Research Sources (web mode)</h3>
          <span class="icon" id="sources-icon">â–¶</span>
        </button>
        <div class="body" id="sources">
          <div class="mono" id="sourcesText"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = "https://YOUR-BACKEND.vercel.app"; // <-- change this

    const el = (id) => document.getElementById(id);
    const errorEl = el("error");
    const resultsEl = el("results");
    const jdTextEl = el("jdText");
    const keywordsTextEl = el("keywordsText");
    const sourcesTextEl = el("sourcesText");

    function showError(msg){
      errorEl.textContent = msg;
      errorEl.style.display = "block";
    }
    function clearError(){ errorEl.style.display = "none"; }

    function togglePanel(panelId){
      const body = el(panelId);
      const icon = el(panelId + "-icon");
      const open = body.classList.contains("open");
      body.classList.toggle("open", !open);
      icon.textContent = open ? "â–¶" : "â–¼";
    }

    function setLoading(btn, loading, label){
      btn.disabled = loading;
      btn.textContent = loading ? "ðŸ”„ Working..." : label;
    }

    function collectInputs(){
      return {
        jobTitle: el("jobTitle").value.trim(),
        company: el("company").value.trim(),
        location: el("location").value.trim(),
        employmentType: el("employmentType").value,
        seniority: el("seniority").value,
        mustSkills: el("mustSkills").value.trim(),
        niceSkills: el("niceSkills").value.trim(),
        responsibilities: el("responsibilities").value.trim(),
        teamMission: el("teamMission").value.trim(),
        tone: el("tone").value,
        length: el("length").value,
      };
    }

    // --- STARTER EXTRACT ---
    el("extractBtn").addEventListener("click", async () => {
      const btn = el("extractBtn");
      clearError();
      setLoading(btn, true, "ðŸ§² Extract Starter Info");

      try {
        const starterMode = el("starterMode").value;
        const jobTitle = el("jobTitle").value.trim();
        const jobPaste = el("jobPaste").value.trim();

        if (starterMode === "none") throw new Error("Choose a Starter Mode (paste or web).");
        if (starterMode === "paste" && !jobPaste) throw new Error("Paste the job posting text first.");
        if (starterMode === "web" && !jobTitle) throw new Error("Enter a job title first.");

        const res = await fetch(`${API_URL}/api/extract-starter`, {
          method: "POST",
          headers: { "Content-Type":"application/json" },
          body: JSON.stringify({ starterMode, jobTitle, jobPaste })
        });

        if (!res.ok){
          const data = await res.json().catch(() => ({}));
          throw new Error(data.error || `Extract failed (${res.status})`);
        }

        const data = await res.json();

        // Fill fields
        if (data.jobTitle) el("jobTitle").value = data.jobTitle;
        if (data.seniority) el("seniority").value = data.seniority;
        if (data.mustSkills) el("mustSkills").value = data.mustSkills;
        if (data.niceSkills) el("niceSkills").value = data.niceSkills;
        if (data.responsibilities) el("responsibilities").value = data.responsibilities;
        if (data.teamMission) el("teamMission").value = data.teamMission;

        // Optional extras
        if (Array.isArray(data.ats_keywords)) {
          keywordsTextEl.textContent = data.ats_keywords.join(", ");
        }
        if (Array.isArray(data.sources)) {
          sourcesTextEl.textContent = data.sources.map(s => `- ${s.title}\n  ${s.url}`).join("\n\n");
        }

        alert("Starter info loaded!");
      } catch (e) {
        showError(e.message);
      } finally {
        setLoading(btn, false, "ðŸ§² Extract Starter Info");
      }
    });

    // --- GENERATE JD ---
    el("generateBtn").addEventListener("click", async () => {
      const btn = el("generateBtn");
      clearError();
      setLoading(btn, true, "âœ¨ Generate Job Description");

      try{
        const payload = collectInputs();
        if (!payload.jobTitle) throw new Error("Job Title is required.");

        const res = await fetch(`${API_URL}/api/generate-jd`, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });

        if (!res.ok){
          const data = await res.json().catch(() => ({}));
          throw new Error(data.error || `Generate failed (${res.status})`);
        }

        const data = await res.json();

        jdTextEl.textContent = data.job_description || "";
        keywordsTextEl.textContent = (data.ats_keywords || []).join(", ");

        resultsEl.classList.add("show");
        resultsEl.scrollIntoView({ behavior:"smooth", block:"start" });
      }catch(e){
        showError(e.message);
      }finally{
        setLoading(btn, false, "âœ¨ Generate Job Description");
      }
    });

    // --- COPY ---
    el("copyBtn").addEventListener("click", async () => {
      try{
        const text = jdTextEl.textContent || "";
        if (!text.trim()) return alert("Generate the JD first.");
        await navigator.clipboard.writeText(text);
        alert("Copied!");
      }catch{
        showError("Copy failed (browser permissions).");
      }
    });
  </script>
</body>
</html>
