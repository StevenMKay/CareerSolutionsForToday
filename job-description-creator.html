<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Job Description Creator</title>

  <!-- âœ… Fix favicon 404 -->
  <link rel="icon" href="https://www.careersolutionsfortoday.com/favicon.ico">

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body{
      background: linear-gradient(135deg, #071326, #0c1f33, #111c2b);
      min-height:100vh;
      font-family:Segoe UI, Arial, sans-serif;
      color:#fff;
    }
    .container{
      max-width:1100px;
      margin:40px auto;
      padding:30px;
      background:rgba(10,20,38,.9);
      border-radius:20px;
      box-shadow:0 20px 60px rgba(0,0,0,.45);
    }
    h1{ text-align:center; margin-bottom:8px; }
    p{ text-align:center; opacity:.85; margin-bottom:24px; }

    .grid{ display:grid; grid-template-columns:1fr 1fr; gap:14px; }
    .field label{ display:block; margin-bottom:6px; font-weight:600; }
    .input,.textarea,.select{
      width:100%;
      padding:12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.25);
      background:rgba(255,255,255,.15);
      color:#fff;
    }
    .textarea{ min-height:100px; resize:vertical; }

    .btn-row{
      display:flex;
      gap:12px;
      justify-content:center;
      margin-top:20px;
      flex-wrap:wrap;
    }
    .btn{
      padding:14px 20px;
      border-radius:10px;
      border:none;
      cursor:pointer;
      font-weight:700;
      color:#fff;
    }
    .primary{ background:linear-gradient(45deg,#0b4f6c,#1976d2); }
    .secondary{ background:linear-gradient(45deg,#4caf50,#45a049); }
    .ghost{ background:rgba(255,255,255,.15); border:1px solid rgba(255,255,255,.25); }

    .error{
      display:none;
      margin-top:16px;
      padding:14px;
      border-radius:10px;
      background:rgba(244,67,54,.2);
      border:1px solid rgba(244,67,54,.6);
      color:#ffb3b3;
    }

    .results{ display:none; margin-top:30px; }
    .panel{
      background:rgba(5,15,30,.85);
      padding:18px;
      border-radius:14px;
      margin-top:14px;
    }
    pre{
      white-space:pre-wrap;
      font-family:monospace;
      font-size:13px;
      background:rgba(255,255,255,.08);
      padding:14px;
      border-radius:10px;
    }

    @media(max-width:900px){
      .grid{ grid-template-columns:1fr; }
    }
  </style>
</head>

<body>
<div class="container">
  <h1>AI Job Description Creator</h1>
  <p>Auto-fill from web research, then generate a polished job description</p>

  <div class="grid">
    <div class="field">
      <label>Job Title *</label>
      <input id="jobTitle" class="input" placeholder="e.g. Senior Risk Governance Lead">
    </div>

    <div class="field">
      <label>Starter Mode</label>
      <select id="starterMode" class="select">
        <option value="none">None</option>
        <option value="paste">Extract from pasted job text</option>
        <option value="web">Search the internet (job title)</option>
      </select>
    </div>
  </div>

  <div class="field" style="margin-top:14px;">
    <label>Paste Job Posting (LinkedIn / any site)</label>
    <textarea id="jobPaste" class="textarea"></textarea>
  </div>

  <div class="btn-row">
    <button id="extractBtn" class="btn ghost">ðŸ§² Extract Starter Info</button>
  </div>

  <div class="grid" style="margin-top:20px;">
    <div class="field">
      <label>Must-have Skills</label>
      <textarea id="mustSkills" class="textarea"></textarea>
    </div>
    <div class="field">
      <label>Nice-to-have Skills</label>
      <textarea id="niceSkills" class="textarea"></textarea>
    </div>
  </div>

  <div class="grid" style="margin-top:14px;">
    <div class="field">
      <label>Responsibilities</label>
      <textarea id="responsibilities" class="textarea"></textarea>
    </div>
    <div class="field">
      <label>Team / Mission</label>
      <textarea id="teamMission" class="textarea"></textarea>
    </div>
  </div>

  <div id="error" class="error"></div>

  <div class="btn-row">
    <button id="generateBtn" class="btn primary">âœ¨ Generate Job Description</button>
    <button id="copyBtn" class="btn secondary">ðŸ“‹ Copy</button>
  </div>

  <div id="results" class="results">
    <div class="panel">
      <h3>Generated Job Description</h3>
      <pre id="jdText"></pre>
    </div>
    <div class="panel">
      <h3>ATS Keywords</h3>
      <pre id="keywordsText"></pre>
    </div>
    <div class="panel">
      <h3>Research Sources</h3>
      <pre id="sourcesText"></pre>
    </div>
  </div>
</div>

<script>
  /* âœ… THIS IS THE ONLY CRITICAL CHANGE */
  const API_URL = "https://resume-analyzer-backend-pi.vercel.app";

  const el = id => document.getElementById(id);
  const errorEl = el("error");

  function showError(msg){
    errorEl.textContent = msg;
    errorEl.style.display = "block";
  }
  function clearError(){ errorEl.style.display = "none"; }

  el("extractBtn").onclick = async () => {
    clearError();
    try {
      const starterMode = el("starterMode").value;
      const jobTitle = el("jobTitle").value.trim();
      const jobPaste = el("jobPaste").value.trim();

      if (starterMode === "none") throw "Choose a starter mode";
      if (starterMode === "web" && !jobTitle) throw "Job title required";
      if (starterMode === "paste" && !jobPaste) throw "Paste job text first";

      const res = await fetch(`${API_URL}/api/extract-starter`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ starterMode, jobTitle, jobPaste })
      });

      const data = await res.json();
      if (!res.ok) throw data.error;

      el("mustSkills").value = data.mustSkills || "";
      el("niceSkills").value = data.niceSkills || "";
      el("responsibilities").value = data.responsibilities || "";
      el("teamMission").value = data.teamMission || "";
      el("keywordsText").textContent = (data.ats_keywords || []).join(", ");
      el("sourcesText").textContent =
        (data.sources || []).map(s => `- ${s.title}\n${s.url}`).join("\n\n");

      alert("Starter data loaded");
    } catch (e) {
      showError(e);
    }
  };

  el("generateBtn").onclick = async () => {
    clearError();
    try {
      const payload = {
        jobTitle: el("jobTitle").value,
        mustSkills: el("mustSkills").value,
        niceSkills: el("niceSkills").value,
        responsibilities: el("responsibilities").value,
        teamMission: el("teamMission").value
      };

      const res = await fetch(`${API_URL}/api/generate-jd`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const data = await res.json();
      if (!res.ok) throw data.error;

      el("jdText").textContent = data.job_description;
      el("keywordsText").textContent = (data.ats_keywords || []).join(", ");
      el("results").style.display = "block";
      el("results").scrollIntoView({ behavior:"smooth" });
    } catch (e) {
      showError(e);
    }
  };

  el("copyBtn").onclick = async () => {
    await navigator.clipboard.writeText(el("jdText").textContent || "");
    alert("Copied!");
  };
</script>
</body>
</html>
