<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Resume Analyzer - Career Solutions for Today</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="site.css">
  <style>
    /* Resume page specific styles */
    .resume-container {
      max-width: 1200px;
      margin: 110px auto 0 auto;
      padding: 30px 20px 60px 20px;
    }

    .resume-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .resume-header h1 {
      color: white;
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .resume-header p {
      color: white;
      font-size: 1.2em;
      opacity: 0.9;
    }

    .upload-section {
      background: rgba(255,255,255,0.15);
      border-radius: 18px;
      box-shadow: 0 2px 18px rgba(0,0,0,0.13);
      padding: 40px;
      margin-bottom: 30px;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      color: white;
    }

    .upload-methods {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }

    .upload-method {
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      border: 2px dashed rgba(255,255,255,0.3);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .upload-method:hover {
      border-color: rgba(255,255,255,0.6);
      background: rgba(255,255,255,0.2);
    }
    .upload-method.success {
      border-color: #4caf50;
      background: rgba(76, 175, 80, 0.2);
      box-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
    }

    .upload-method.success h3 {
      color: #4caf50;
    }

    .upload-method h3 {
      color: white;
      margin-bottom: 15px;
      font-size: 1.3em;
    }

    .file-upload {
      position: relative;
      display: inline-block;
      width: 100%;
    }

    .file-upload input[type=file] {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    .upload-btn {
      background: #0b4f6c;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
      width: 100%;
    }

    .upload-btn:hover {
      background: #0a4460;
    }

    .drag-drop-area {
      border: 2px dashed rgba(255,255,255,0.4);
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      margin: 20px 0;
      transition: all 0.3s ease;
    }

    .drag-drop-area.dragover {
      border-color: #0b4f6c;
      background: rgba(11,79,108,0.1);
    }

    .drag-drop-area.success {
      border-color: #4caf50;
      background: rgba(76, 175, 80, 0.2);
      box-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
    }

    /* Enhanced drag feedback */
    .drag-drop-area.drag-active {
      border-color: #2196f3;
      background: rgba(33, 150, 243, 0.15);
      box-shadow: 0 0 30px rgba(33, 150, 243, 0.4);
      transform: scale(1.02);
      transition: all 0.2s ease;
    }

    .drag-drop-area.drag-active::before {
      content: 'üìÑ Drop your resume here!';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(33, 150, 243, 0.9);
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 16px;
      z-index: 10;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      animation: pulse 1.5s infinite;
    }

    .drag-drop-area.drag-active::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border: 3px dashed #2196f3;
      border-radius: 12px;
      animation: dashMove 2s linear infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.05); }
    }

    @keyframes dashMove {
      0% { border-dash-offset: 0; }
      100% { border-dash-offset: 20px; }
    }

    /* Body drag overlay */
    body.dragging::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(33, 150, 243, 0.1);
      z-index: 5;
      pointer-events: none;
    }

    .text-input-section {
      grid-column: 1 / -1;
    }

    .resume-textarea {
      width: 100%;
      min-height: 200px;
      padding: 15px;
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 8px;
      background: rgba(255,255,255,0.1);
      color: white;
      font-size: 14px;
      font-family: 'Segoe UI', sans-serif;
      resize: vertical;
    }

    .resume-textarea::placeholder {
      color: rgba(255,255,255,0.7);
    }

    .resume-textarea.success {
      border-color: #4caf50;
      background: rgba(76, 175, 80, 0.15);
      box-shadow: 0 0 15px rgba(76, 175, 80, 0.3);
    }

    .analyze-btn {
      background: linear-gradient(45deg, #0b4f6c, #1976d2);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
      margin-top: 20px;
      transition: all 0.3s ease;
      display: block;
      margin: 20px auto 0 auto;
    }

    .analyze-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(11,79,108,0.4);
    }

    .analyze-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .feedback-section {
      background: rgba(255,255,255,0.15);
      border-radius: 18px;
      box-shadow: 0 2px 18px rgba(0,0,0,0.13);
      padding: 40px;
      margin-bottom: 30px;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      color: white;
      display: none;
    }

    .demo-feedback-section {
      background: rgba(255,255,255,0.12);
      border-radius: 18px;
      box-shadow: 0 2px 18px rgba(0,0,0,0.12);
      padding: 35px;
      margin-bottom: 30px;
      color: white;
      border: 1px dashed rgba(255,255,255,0.35);
    }

    .demo-feedback-section .demo-note {
      font-size: 0.9em;
      color: rgba(255,255,255,0.8);
      margin-top: 15px;
    }

    .demo-feedback-card {
      margin-top: 20px;
      padding: 25px;
      border-radius: 14px;
      background: rgba(11,79,108,0.25);
      border: 1px solid rgba(255,255,255,0.15);
    }

    .demo-feedback-card h3 {
      margin-bottom: 10px;
    }

    .demo-score-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 14px;
      border-radius: 999px;
      background: rgba(33,150,243,0.25);
      border: 1px solid rgba(33,150,243,0.4);
      font-weight: 600;
    }

    .demo-score-group {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      margin-bottom: 12px;
    }

    .demo-keyword-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      border-radius: 999px;
      background: rgba(76,175,80,0.2);
      border: 1px solid rgba(76,175,80,0.3);
      font-weight: 600;
    }

    .demo-feedback-list {
      margin-top: 15px;
      padding-left: 20px;
    }

    .demo-feedback-subheading {
      margin-top: 18px;
      margin-bottom: 4px;
      font-size: 1rem;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.85);
    }

    .demo-feedback-section blockquote {
      margin: 18px 0 0 0;
      padding: 12px 16px;
      border-left: 3px solid rgba(255,255,255,0.4);
      background: rgba(255,255,255,0.08);
      font-size: 0.95em;
    }

    .feedback-section.show {
      display: block;
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .feedback-category {
      margin-bottom: 25px;
      padding: 20px;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      border-left: 4px solid #1976d2;
    }

    .feedback-category h3 {
      color: white;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .feedback-category.good {
      border-left-color: #4caf50;
    }

    .feedback-category.warning {
      border-left-color: #ff9800;
    }

    .feedback-category.critical {
      border-left-color: #f44336;
    }

    .status-icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: inline-block;
    }

    .status-icon.good { background: #4caf50; }
    .status-icon.warning { background: #ff9800; }
    .status-icon.critical { background: #f44336; }

    .download-section {
      background: rgba(255,255,255,0.15);
      border-radius: 18px;
      box-shadow: 0 2px 18px rgba(0,0,0,0.13);
      padding: 40px;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      color: white;
      display: none;
    }

    .download-section.show {
      display: block;
      animation: fadeIn 0.5s ease-in;
    }

    .download-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .download-option {
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 25px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .download-option:hover {
      background: rgba(255,255,255,0.2);
      transform: translateY(-3px);
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    }

    .download-option h4 {
      color: white;
      margin-bottom: 10px;
      font-size: 1.2em;
    }

    .download-option p {
      color: rgba(255,255,255,0.8);
      font-size: 0.9em;
      margin-bottom: 15px;
    }

    .download-btn {
      background: #0b4f6c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }

    .download-btn:hover {
      background: #0a4460;
    }

    .progress-bar {
      width: 100%;
      height: 4px;
      background: rgba(255,255,255,0.2);
      border-radius: 2px;
      margin: 20px 0;
      overflow: hidden;
      display: none;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #0b4f6c, #1976d2);
      width: 0%;
      transition: width 0.3s ease;
    }

    @media (max-width: 768px) {
      .upload-methods {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .resume-container {
        padding: 20px 15px;
      }

      .upload-section, .feedback-section, .download-section {
        padding: 25px;
      }

      .resume-header h1 {
        font-size: 2em;
      }

      .text-input-section {
        grid-column: 1 / -1;
      }
    }
  </style>
</head>

<body>
  <nav class="navbar">
    <div class="nav-logo">Career Solutions for Today</div>
    <ul class="nav-links" id="navLinks">
      <li><a href="index.html">Home</a></li>
      <li><a href="Learn.html" class="learn-underline">Learning Resources</a></li>
      <!--
      <li class="dropdown" id="toolsDropdown">
        <span class="dropdown-toggle" id="toolsToggle">Tools</span>
        <ul class="dropdown-menu" id="toolsDropdownMenu">
          <li><a href="businesscase.html" target="_blank">Business Case Calculator</a></li>
          <li><a href="amortization.html" target="_blank">Amortization Calculator</a></li>
          <li><a href="Signature Builder.html" target="_blank">Email Signature Builder</a></li>
          <li><a href="Excel.html" target="_blank">Excel Simulations</a></li>
          <li><a href="shortcuts.html" target="_blank">Shortcuts</a></li>
        </ul>
      </li>
      -->
      <!-- <li><a href="practice.html">Practice</a></li> -->
      <li><a href="codeplayground.html">Code Playground</a></li>
      <li><a href="products.html">Products</a></li>
      <li><a href="contact-form.html">Contact Me</a></li>
      <li><a href="AboutMe.html" class="about-underline">About Me</a></li>
    </ul>
    <div class="hamburger" onclick="document.querySelector('.nav-links').classList.toggle('active')">
      <div></div>
      <div></div>
      <div></div>
    </div>
  </nav>

  <div class="resume-container">
    <div class="resume-header">
      <h1>AI-Powered Resume Analyzer</h1>
      <p>Upload your resume and get instant feedback to land your dream job</p>
    </div>

    <div class="upload-section">
      <h2 style="color: white; text-align: center; margin-bottom: 30px;">Upload Your Resume</h2>
      
      <div class="upload-methods">
        <div class="upload-method">
          <h3>üìÑ Upload File</h3>
          <p>Upload your resume in PDF, DOC, or DOCX format</p>
          <div class="file-upload">
            <input type="file" id="fileInput" accept=".pdf,.doc,.docx" />
            <button class="upload-btn">Choose File</button>
          </div>
        </div>

        <div class="upload-method" id="dragDropArea">
          <h3>üéØ Drag & Drop</h3>
          <p>Drag your resume file here for quick upload</p>
          <div class="drag-drop-area">
            <p>Drop your file here</p>
          </div>
        </div>

        <div class="text-input-section upload-method">
          <h3>üìù Copy & Paste Resume</h3>
          <p>Paste your resume text directly into the box below</p>
          <textarea 
            class="resume-textarea" 
            id="resumeText" 
            placeholder="Paste your resume text here...&#10;&#10;Include all sections: Contact info, Summary, Experience, Education, Skills, etc."
          ></textarea>
        </div>

        <div class="text-input-section upload-method">
          <h3>üéØ Job Description (Optional)</h3>
          <p>Paste the job description you're applying for to get targeted feedback</p>
          <textarea 
            class="resume-textarea" 
            id="jobDescriptionText" 
            style="min-height: 150px;"
            placeholder="Paste the job description here (optional)...&#10;&#10;Include: Job title, requirements, responsibilities, preferred skills, etc.&#10;&#10;This helps tailor the analysis to match what employers are looking for!"
          ></textarea>
        </div>
      </div>

      <div class="progress-bar" id="progressBar">
        <div class="progress-fill" id="progressFill"></div>
      </div>

      <button class="analyze-btn" id="analyzeBtn" disabled>
        üîç Analyze My Resume
      </button>
    </div>

    <!--
      LLM Integration Placeholder
      1. The block below is wired to show sample output whenever the user uploads or pastes a resume.
      2. Once your backend + LLM are ready, replace the demo markup by the live payload returned from performAIResumeAnalysis().
      3. Keep the DOM IDs (#demoFeedbackSection, #demoFeedbackContent) so the helper can be swapped without recreating UI bindings.
    -->
    <div class="demo-feedback-section" id="demoFeedbackSection">
      <h2>LLM Feedback Preview</h2>
      <p>This sandbox mirrors the structure of the AI report. Upload any file or paste text to see a sample of the insights a connected LLM would return.</p>
      <div class="demo-feedback-card" id="demoFeedbackContent">
        <h3>Waiting for a resume...</h3>
        <p>Upload a PDF/DOCX or paste your resume to populate this space with a generated example. The live version would surface strengths, risks, and keyword coverage.</p>
      </div>
      <p class="demo-note">Integration note: send the raw resume text (and optional job description) to your backend, call your preferred LLM (OpenAI, Azure OpenAI, Anthropic, etc.), then pass the structured response into <code>displayAnalysisResults()</code>.</p>
    </div>

    <div class="feedback-section" id="feedbackSection">
      <h2 style="color: white; text-align: center; margin-bottom: 30px;">Resume Analysis Results</h2>
      <div id="feedbackContent"></div>
    </div>

    <div class="download-section" id="downloadSection">
      <h2 style="color: white; text-align: center; margin-bottom: 20px;">Download Improved Resume</h2>
      <p style="text-align: center; margin-bottom: 30px;">Choose your preferred resume template and download the improved version</p>
      
      <div class="download-options">
        <div class="download-option" onclick="downloadResume('modern')">
          <h4>üé® Modern Resume</h4>
          <p>Contemporary design with color accents and modern layout. Perfect for creative and tech roles.</p>
          <button class="download-btn">Download Modern (.docx)</button>
        </div>

        <div class="download-option" onclick="downloadResume('classic')">
          <h4>üìã Classic Resume</h4>
          <p>Traditional black and white format. Ideal for conservative industries and formal positions.</p>
          <button class="download-btn">Download Classic (.docx)</button>
        </div>

        <div class="download-option" onclick="downloadResume('original')">
          <h4>üîÑ Same Format</h4>
          <p>Keep your original format but with improved content based on our suggestions.</p>
          <button class="download-btn">Download Improved (.docx)</button>
        </div>
      </div>
    </div>
  </div>

  <script src="js/backgrounds.js"></script>
  <script src="js/universalSidebar.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.5.0/docx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/file-saver/2.0.5/FileSaver.min.js"></script>
  
  <script>
    let resumeData = null;
    let analysisResults = null;

    // üîí Backend URL (API key is safely stored on server)
    const BACKEND_URL = 'https://resume-analyzer-backend-pi.vercel.app/api/analyze';

    // üí∞ Usage tracking (hidden but still functional)
    const MONTHLY_BUDGET_LIMIT = 20.00;
    const COST_PER_ANALYSIS = 0.01;

    // Demo suggestion bank for the preview card. Remove when live LLM output is wired up.
    const DEMO_FEEDBACK_BANK = [
      'Quantify at least one achievement per role to highlight measurable impact.',
      'Mirror the job description keywords inside your skills section for ATS alignment.',
      'Move certifications above education when targeting senior roles.',
      'Tighten your summary to three sentences that emphasize years of experience and domain expertise.',
      'Split soft and technical skills into separate bullets to improve scanning.',
      'Add a tools row (Salesforce, HubSpot, Zendesk, etc.) if the posting references them explicitly.',
      'Consider trimming earlier roles to highlights to keep the resume at two pages.',
      'Link to portfolio or GitHub for quicker recruiter review.',
      'Use consistent tense (present for current role, past for previous roles).',
      'Group achievements under micro-headings (Growth, Efficiency, CX) for clearer storytelling.'
    ];

    function getJobDescriptionValue() {
      const jobDescriptionInput = document.getElementById('jobDescriptionText');
      return jobDescriptionInput ? jobDescriptionInput.value.trim() : '';
    }
    
    // Hidden usage tracking functions (no UI display)
    function getUsageData() {
      const currentMonth = new Date().toISOString().slice(0, 7);
      const stored = localStorage.getItem('resumeAnalyzer_usage');
      
      if (!stored) {
        return { month: currentMonth, count: 0, cost: 0 };
      }
      
      const data = JSON.parse(stored);
      
      if (data.month !== currentMonth) {
        return { month: currentMonth, count: 0, cost: 0 };
      }
      
      return data;
    }
    
    function updateUsageData() {
      const currentMonth = new Date().toISOString().slice(0, 7);
      const usage = getUsageData();
      
      usage.month = currentMonth;
      usage.count += 1;
      usage.cost += COST_PER_ANALYSIS;
      
      localStorage.setItem('resumeAnalyzer_usage', JSON.stringify(usage));
      
      // Log usage for admin tracking (hidden from users)
      console.log(`Usage Update: ${usage.count} analyses, $${usage.cost.toFixed(2)} cost this month`);
      
      return usage;
    }
    
    function checkBudgetLimit() {
      const usage = getUsageData();
      return usage.cost < MONTHLY_BUDGET_LIMIT;
    }

    // File upload handling
    document.getElementById('fileInput').addEventListener('change', handleFileUpload);
    
    // Drag and drop handling
    const dragDropArea = document.getElementById('dragDropArea');
    const dragDropContainer = dragDropArea.querySelector('.drag-drop-area');
    
    // Enhanced drag and drop event listeners
    dragDropArea.addEventListener('dragover', handleDragOver);
    dragDropArea.addEventListener('drop', handleFileDrop);
    dragDropArea.addEventListener('dragleave', handleDragLeave);
    dragDropArea.addEventListener('dragenter', handleDragEnter);

    // Global drag detection for full-page overlay
    let dragCounter = 0;
    document.addEventListener('dragenter', function(e) {
      e.preventDefault();
      dragCounter++;
      if (dragCounter === 1) {
        document.body.classList.add('dragging');
      }
    });

    document.addEventListener('dragleave', function(e) {
      e.preventDefault();
      dragCounter--;
      if (dragCounter === 0) {
        document.body.classList.remove('dragging');
      }
    });

    document.addEventListener('drop', function(e) {
      e.preventDefault();
      dragCounter = 0;
      document.body.classList.remove('dragging');
    });

    // Text input handling
    document.getElementById('resumeText').addEventListener('input', handleTextInput);
    document.getElementById('resumeText').addEventListener('paste', handleTextPaste);

    // Analyze button
    document.getElementById('analyzeBtn').addEventListener('click', analyzeResume);

    // Utility function to clear success states
    function clearSuccessStates(except = []) {
      if (!except.includes('file')) {
        // Clear file upload success
        const fileUploadMethod = document.querySelector('.upload-method:first-child');
        fileUploadMethod.classList.remove('success');
      }
      
      if (!except.includes('dragdrop')) {
        // Clear drag-drop success
        const dragDropMethod = document.getElementById('dragDropArea');
        const dragDropContainer = dragDropMethod.querySelector('.drag-drop-area');
        dragDropMethod.classList.remove('success');
        dragDropContainer.classList.remove('success');
      }
      
      if (!except.includes('textarea')) {
        // Clear textarea success
        const textareas = document.querySelectorAll('.resume-textarea');
        textareas.forEach(textarea => {
          textarea.classList.remove('success');
          textarea.closest('.upload-method').classList.remove('success');
        });
      }
    }

    // Handle paste events in text areas
    function handleTextPaste(event) {
      const textarea = event.target;
      
      // Use setTimeout to get the pasted content after it's been inserted
      setTimeout(() => {
        const text = textarea.value.trim();
        if (text.length > 50) {
          // Clear other success states when pasting
          clearSuccessStates(['textarea']);
          
          // Add success state to this textarea and its parent
          textarea.classList.add('success');
          textarea.closest('.upload-method').classList.add('success');
          
          resumeData = { type: 'text', content: text };
          document.getElementById('analyzeBtn').disabled = false;
          showDemoLLMFeedback({
            sourceLabel: 'Sample report for pasted resume',
            filename: 'Pasted resume',
            charCount: text.length,
            preview: text.slice(0, 240),
            resumeText: text,
            jobDescription: getJobDescriptionValue()
          });
        }
      }, 10);
    }

    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (file) {
        // Clear any existing success states
        clearSuccessStates();
        
        // Add success state to the file upload method
        const fileUploadMethod = document.querySelector('.upload-method:first-child');
        fileUploadMethod.classList.add('success');
        
        processFile(file);
      }
    }

    function handleDragEnter(event) {
      event.preventDefault();
      event.stopPropagation();
      dragDropContainer.classList.add('drag-active');
    }

    function handleDragOver(event) {
      event.preventDefault();
      event.stopPropagation();
      dragDropContainer.classList.add('drag-active');
    }

    function handleDragLeave(event) {
      event.preventDefault();
      event.stopPropagation();
      
      // Only remove drag-active if we're leaving the actual drag area
      if (!dragDropArea.contains(event.relatedTarget)) {
        dragDropContainer.classList.remove('drag-active');
      }
    }

    function handleFileDrop(event) {
      event.preventDefault();
      event.stopPropagation();
      
      // Remove all drag states
      dragDropContainer.classList.remove('dragover', 'drag-active');
      document.body.classList.remove('dragging');
      dragCounter = 0;
      
      const files = event.dataTransfer.files;
      if (files.length > 0) {
        // Clear any existing success states
        clearSuccessStates();
        
        // Add success state to drag-drop area
        dragDropArea.classList.add('success');
        dragDropContainer.classList.add('success');
        
        processFile(files[0]);
      }
    }

    function handleTextInput(event) {
      const text = event.target.value.trim();
      const textarea = event.target;
      
      if (text.length > 50) {
        // Clear other success states when typing in text area
        clearSuccessStates(['textarea']);
        
        // Add success state to this textarea and its parent
        textarea.classList.add('success');
        textarea.closest('.upload-method').classList.add('success');
        
        resumeData = { type: 'text', content: text };
        document.getElementById('analyzeBtn').disabled = false;
        showDemoLLMFeedback({
          sourceLabel: 'Sample report for pasted resume',
          filename: 'Pasted resume',
          charCount: text.length,
          preview: text.slice(0, 240),
          resumeText: text,
          jobDescription: getJobDescriptionValue()
        });
      } else {
        // Remove success state if text is too short
        textarea.classList.remove('success');
        textarea.closest('.upload-method').classList.remove('success');
        document.getElementById('analyzeBtn').disabled = true;
      }
    }

    async function processFile(file) {
      const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
      
      if (!allowedTypes.includes(file.type)) {
        alert('Please upload a PDF, DOC, or DOCX file.');
        return;
      }

      // Show progress bar
      const progressBar = document.getElementById('progressBar');
      const progressFill = document.getElementById('progressFill');
      progressBar.style.display = 'block';

      try {
        let extractedText = '';

        if (file.type === 'application/pdf') {
          extractedText = await extractTextFromPDF(file);
        } else if (file.type.includes('word') || file.type.includes('document')) {
          extractedText = await extractTextFromWord(file);
        }

        // Simulate progress
        let progress = 0;
        const interval = setInterval(() => {
          progress += 10;
          progressFill.style.width = progress + '%';
          
          if (progress >= 100) {
            clearInterval(interval);
            setTimeout(() => {
              progressBar.style.display = 'none';
              progressFill.style.width = '0%';
              
              if (extractedText.trim().length > 50) {
                resumeData = { type: 'file', content: extractedText, filename: file.name };
                document.getElementById('analyzeBtn').disabled = false;
                showDemoLLMFeedback({
                  sourceLabel: `Sample report for ${file.name}`,
                  filename: file.name,
                  charCount: extractedText.length,
                  preview: extractedText.slice(0, 240),
                  resumeText: extractedText,
                  jobDescription: getJobDescriptionValue()
                });
                alert(`File "${file.name}" processed successfully! ${extractedText.length} characters extracted. Click "Analyze My Resume" to continue.`);
              } else {
                alert('Could not extract enough text from the file. Please try a different file or use copy/paste method.');
              }
            }, 500);
          }
        }, 200);

      } catch (error) {
        progressBar.style.display = 'none';
        alert('Error processing file: ' + error.message);
      }
    }

    async function extractTextFromPDF(file) {
      const arrayBuffer = await file.arrayBuffer();
      const pdf = await PDFLib.PDFDocument.load(arrayBuffer);
      const pages = pdf.getPages();
      
      let text = '';
      // Note: PDFLib doesn't extract text directly, this is a simplified version
      // In a real app, you'd use pdf-parse or similar library
      text = "PDF text extraction requires server-side processing. Please copy and paste your resume text instead, or upload a Word document.";
      return text;
    }

    async function extractTextFromWord(file) {
      const arrayBuffer = await file.arrayBuffer();
      const result = await mammoth.extractRawText({ arrayBuffer: arrayBuffer });
      return result.value;
    }

    async function analyzeResume() {
      if (!resumeData) {
        alert('Please upload a resume or paste resume text first.');
        return;
      }

      // Check budget limit (hidden tracking)
      if (!checkBudgetLimit()) {
        const usage = getUsageData();
        alert(`üí∞ Monthly analysis limit reached!\n\nPlease try again next month. This protects against unexpected usage costs.`);
        return;
      }

      // Get job description (optional)
      const jobDescription = document.getElementById('jobDescriptionText').value.trim();

      // Show analyzing state
      const analyzeBtn = document.getElementById('analyzeBtn');
      analyzeBtn.textContent = jobDescription ? 
        'üîÑ Analyzing Resume vs Job Description...' : 
        'üîÑ Analyzing Resume...';
      analyzeBtn.disabled = true;

      try {
        const analysis = await performAIResumeAnalysis(resumeData.content, jobDescription);
        
        // Update usage tracking (hidden)
        updateUsageData();
        
        displayAnalysisResults(analysis, !!jobDescription);
        
        // Scroll to results
        document.getElementById('feedbackSection').scrollIntoView({ behavior: 'smooth' });
      } catch (error) {
        console.error('Analysis error details:', error);
        
        let errorMessage = 'Error analyzing resume: ' + error.message;
        
        // Provide more specific error messages
        if (error.message.includes('Failed to fetch')) {
          errorMessage = 'Unable to connect to the analysis service. This could be due to:\n\n' +
                       '‚Ä¢ Network connectivity issues\n' +
                       '‚Ä¢ The backend service being temporarily unavailable\n' +
                       '‚Ä¢ CORS or firewall restrictions\n\n' +
                       'A mock analysis will be shown for testing purposes.';
        } else if (error.message.includes('parse')) {
          errorMessage = 'The server response could not be processed:\n\n' + error.message + 
                       '\n\nPlease check the browser console for more details.';
        }
        
        alert(errorMessage + '\n\nNo usage counted for failed attempts.');
      } finally {
        analyzeBtn.textContent = 'üîç Analyze My Resume';
        analyzeBtn.disabled = false;
      }
    }

    async function performAIResumeAnalysis(resumeText, jobDescription = '') {
      try {
        console.log('=== ANALYSIS DEBUG INFO ===');
        console.log('Backend URL:', BACKEND_URL);
        console.log('Resume text length:', resumeText.length);
        console.log('Resume text preview:', resumeText.substring(0, 200) + '...');
        console.log('Job description length:', jobDescription.length);
        
        const requestBody = {
          resumeText: resumeText,
          jobDescription: jobDescription
        };
        
        console.log('Request body:', JSON.stringify(requestBody, null, 2));
        
        const response = await fetch(BACKEND_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(requestBody)
        });

        console.log('Response status:', response.status);
        console.log('Response statusText:', response.statusText);
        console.log('Response headers:', [...response.headers.entries()]);

        const responseText = await response.text();
        console.log('Raw response text:', responseText);

        if (!response.ok) {
          let errorMessage = `HTTP ${response.status}: ${response.statusText}`;
          try {
            const errorData = JSON.parse(responseText);
            console.log('Parsed error data:', errorData);
            errorMessage = errorData.message || errorMessage;
          } catch (e) {
            console.log('Could not parse error response as JSON:', e);
            errorMessage = responseText || errorMessage;
          }
          
          // If it's the "Failed to parse AI analysis results" error, provide a workaround
          if (errorMessage.includes('Failed to parse AI analysis results')) {
            console.log('Backend AI parsing failed, using mock response for demonstration...');
            alert('The backend AI service is currently having issues parsing the resume. Using a demo response to show the interface functionality.');
            return getMockAnalysisResponse();
          }
          
          throw new Error(`Backend Error: ${errorMessage}`);
        }
        
        let data;
        try {
          data = JSON.parse(responseText);
          console.log('Successfully parsed response:', data);
        } catch (parseError) {
          console.error('JSON parse error:', parseError);
          console.log('Using mock response due to parse error...');
          alert('Server response could not be parsed. Using demo response to show interface functionality.');
          return getMockAnalysisResponse();
        }
        
        if (!data.success) {
          console.log('Server returned success=false:', data);
          if (data.message && data.message.includes('Failed to parse AI analysis results')) {
            console.log('AI parsing failed on server, using mock response...');
            alert('The AI analysis service is temporarily having issues. Using a demo response to show the interface functionality.');
            return getMockAnalysisResponse();
          }
          throw new Error(`Analysis failed: ${data.message || 'Unknown error'}`);
        }

        if (!data.analysis) {
          console.log('No analysis data in response:', data);
          alert('No analysis data received. Using demo response to show interface functionality.');
          return getMockAnalysisResponse();
        }

        console.log('Analysis successful:', data.analysis);
        return data.analysis;
        
      } catch (error) {
        console.error('=== ANALYSIS ERROR ===');
        console.error('Error type:', error.constructor.name);
        console.error('Error message:', error.message);
        console.error('Error stack:', error.stack);
        
        // If it's a network error, provide mock response
        if (error.message.includes('Failed to fetch') || error.message.includes('network') || error.name === 'TypeError') {
          console.log('Network error detected, providing mock response...');
          alert('Demo response loaded. For full functionality, integrate an LLM.');
          return getMockAnalysisResponse();
        }
        
        throw error;
      }
    }

    // Mock response for testing when backend is unavailable
    function getMockAnalysisResponse() {
      return {
        overallScore: 78,
        categories: [
          {
            name: "Contact Information",
            score: 85,
            status: "good",
            feedback: "Contact information is complete and professional.",
            suggestions: []
          },
          {
            name: "Professional Summary",
            score: 72,
            status: "warning", 
            feedback: "Summary is present but could be more compelling.",
            suggestions: ["Add specific achievements with metrics", "Tailor summary to target role"]
          },
          {
            name: "Work Experience",
            score: 80,
            status: "good",
            feedback: "Good work experience with relevant positions.",
            suggestions: ["Add more quantified results", "Use stronger action verbs"]
          },
          {
            name: "Skills Section",
            score: 75,
            status: "warning",
            feedback: "Skills are listed but could be better organized.",
            suggestions: ["Group skills into categories", "Add proficiency levels"]
          },
          {
            name: "Education",
            score: 90,
            status: "good", 
            feedback: "Education section is well formatted.",
            suggestions: []
          }
        ]
      };
    }

    /**
     * üîå LLM Integration Helper (Demo)
     * Replace this demo renderer with real data once your backend returns LLM output. Integration steps:
     * 1. Send resume/job description text to your secured API route (never expose keys in the browser).
     * 2. Have the backend call your preferred LLM provider and normalize the response to the structure used by displayAnalysisResults().
     * 3. Swap showDemoLLMFeedback() with displayAnalysisResults(realData) to keep the UI identical while powering it with production insights.
     */
    function showDemoLLMFeedback({
      sourceLabel = 'Uploaded resume sample',
      filename = 'resume.pdf',
      charCount = 0,
      preview = '',
      resumeText = '',
      jobDescription = ''
    } = {}) {
      const section = document.getElementById('demoFeedbackSection');
      const contentNode = document.getElementById('demoFeedbackContent');
      if (!section || !contentNode) return;

      const heuristics = analyzeResumeHeuristics(resumeText, jobDescription, charCount);
      const strengths = heuristics.strengths.length ? heuristics.strengths : ['Overall structure looks solid.'];
      const improvements = heuristics.improvements.length ? heuristics.improvements : pickDemoSuggestions(3);
      const readingTime = Math.max(1, Math.round((heuristics.charCount || charCount || 600) / 1200));

      const previewBlock = preview
        ? `<blockquote><strong>Excerpt preview:</strong> ${preview}${preview.length >= 240 ? '‚Ä¶' : ''}</blockquote>`
        : '';

      const keywordPill = typeof heuristics.keywordMatchPct === 'number'
        ? `<div class="demo-keyword-pill">Keyword match ‚âà ${heuristics.keywordMatchPct}%</div>`
        : '';

      const keywordSummary = heuristics.keywordSummary
        ? `<p class="demo-note">${heuristics.keywordSummary}</p>`
        : '';

      contentNode.innerHTML = `
        <div class="demo-score-group">
          <div class="demo-score-pill">Sample score: ${heuristics.score}/100</div>
          ${keywordPill}
        </div>
        <p>${sourceLabel} scanned. These notes use lightweight heuristics so you can preview how AI feedback would read once the live model is connected.</p>
        <h4 class="demo-feedback-subheading">Strengths detected</h4>
        <ul class="demo-feedback-list">
          ${strengths.map(item => `<li>${item}</li>`).join('')}
        </ul>
        <h4 class="demo-feedback-subheading">Opportunities to improve</h4>
        <ul class="demo-feedback-list">
          ${improvements.map(item => `<li>${item}</li>`).join('')}
        </ul>
        ${keywordSummary}
        <p class="demo-note">
          Estimated read time: ${readingTime} min ‚Ä¢ File reference: ${filename}
        </p>
        ${previewBlock}
      `;

      section.classList.add('show');
    }

    function pickDemoSuggestions(count = 3) {
      const pool = [...DEMO_FEEDBACK_BANK];
      const output = [];
      while (pool.length && output.length < count) {
        const index = Math.floor(Math.random() * pool.length);
        output.push(pool.splice(index, 1)[0]);
      }
      return output;
    }

    const RESUME_STOPWORDS = new Set(['the','and','with','from','that','this','your','about','their','been','were','have','will','into','through','shall','such','than','then','them','they','over','also','able','other','upon','ourselves','myself','itself','those','these']);
    const ACTION_VERBS = ['led','built','managed','launched','implemented','optimized','created','increased','reduced','designed','spearheaded','developed','executed','improved','scaled','delivered','streamlined','automated','drove','facilitated'];

    function analyzeResumeHeuristics(resumeText = '', jobDescription = '', fallbackCharCount = 0) {
      const text = resumeText || '';
      const normalized = text.toLowerCase();
      const charCount = text.length || fallbackCharCount;
      const strengths = [];
      const improvements = [];
      let score = 68;

      if (!text.trim()) {
        return {
          score: generateDemoScore(charCount || 400),
          strengths: [],
          improvements: pickDemoSuggestions(3),
          keywordMatchPct: jobDescription ? 15 : null,
          keywordSummary: jobDescription ? 'Add resume text to compare it with your job description keywords.' : null,
          charCount
        };
      }

      // Length heuristics
      if (charCount >= 1500 && charCount <= 6500) {
        strengths.push('Length falls within the typical 1‚Äì2 page range, which ATS systems prefer.');
        score += 5;
      } else if (charCount < 900) {
        improvements.push('Resume is on the short side‚Äîexpand bullet points with context and outcomes.');
        score -= 5;
      } else if (charCount > 7000) {
        improvements.push('Document is lengthy; trim older roles or consolidate bullets to stay near two pages.');
        score -= 4;
      }

      // Contact info
      const hasEmail = /[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/i.test(text);
      const hasPhone = /\d{3}[)\-\.\s]?\d{3}[\-\.\s]?\d{4}/.test(text);
      if (hasEmail && hasPhone) {
        strengths.push('Contact details (email + phone) are easy to find.');
      } else {
        improvements.push('Add both an email and phone number in the header for quick recruiter outreach.');
        score -= 3;
      }

      // Summary/profile
      if (/summary|profile|objective/.test(normalized)) {
        strengths.push('Includes an opening summary/profile to frame the story.');
      } else {
        improvements.push('Add a short summary at the top to highlight role fit and value proposition.');
        score -= 2;
      }

      // Skills section
      if (/skills|competenc|technolog|stack|tools/.test(normalized)) {
        strengths.push('Dedicated skills/technology section detected for quick keyword scanning.');
      } else {
        improvements.push('Add a skills or tools section so ATS systems can match you faster.');
        score -= 2;
      }

      // Metrics and action verbs
      const metricMatches = text.match(/\b\d+(?:\.\d+)?(?:%| percent|k|m)?/gi) || [];
      if (metricMatches.length >= 5) {
        strengths.push('Multiple quantified achievements present‚Äîgreat for credibility.');
        score += 4;
      } else {
        improvements.push('Add more metrics (%, $, volume) to prove impact.');
      }

      const actionHits = ACTION_VERBS.filter(verb => normalized.includes(`${verb} `)).length;
      if (actionHits >= 5) {
        strengths.push('Uses strong action verbs to lead bullets.');
      } else {
        improvements.push('Open bullets with stronger action verbs (led, scaled, launched, etc.).');
      }

      // Bullet formatting
      const bulletCount = (text.match(/(^|\n)\s*(?:[-‚Ä¢*]|\d+\.)/g) || []).length;
      if (bulletCount >= 8) {
        strengths.push('Bulleted format keeps the content skimmable.');
      } else {
        improvements.push('Break dense paragraphs into bullets for easier scanning.');
        score -= 1;
      }

      // Job description alignment
      const jobKeywords = extractJobKeywords(jobDescription);
      let keywordMatchPct = null;
      let keywordSummary = '';
      if (jobKeywords.length) {
        const hits = jobKeywords.filter(word => normalized.includes(word));
        keywordMatchPct = Math.round((hits.length / jobKeywords.length) * 100);
        if (keywordMatchPct >= 60) {
          strengths.push('Resume already mirrors many of the job description keywords.');
          score += 3;
        } else {
          improvements.push('Mirror more job description keywords inside your skills and bullets.');
          score -= 2;
        }
        keywordSummary = `${hits.length}/${jobKeywords.length} priority keywords detected (${keywordMatchPct}%).`;
      }

      score = Math.max(55, Math.min(95, score));

      return {
        score,
        strengths,
        improvements,
        keywordMatchPct,
        keywordSummary,
        charCount
      };
    }

    function extractJobKeywords(jobDescription = '') {
      const tokens = jobDescription.toLowerCase().match(/\b[a-z]{4,}\b/g) || [];
      const filtered = tokens.filter(token => !RESUME_STOPWORDS.has(token));
      const unique = [...new Set(filtered)];
      return unique.slice(0, 18);
    }

    function generateDemoScore(charCount = 0) {
      const base = 70 + Math.floor(Math.random() * 20);
      const lengthBonus = Math.min(8, Math.floor(charCount / 800));
      return Math.min(96, base + lengthBonus);
    }

    function displayAnalysisResults(analysis, hasJobDescription = false) {
      analysisResults = analysis;
      
      const feedbackContent = document.getElementById('feedbackContent');
      const overallScore = analysis.overallScore;
      
      let html = `
        <div style="text-align: center; margin-bottom: 30px;">
          <h3 style="color: white; font-size: 2em; margin-bottom: 10px;">Overall Score: ${overallScore}/100</h3>
          ${hasJobDescription ? '<p style="color: #00ff00; margin-bottom: 10px;">‚úÖ Analyzed against job description</p>' : ''}
          <div style="width: 100%; background: rgba(255,255,255,0.2); border-radius: 10px; height: 20px; margin: 0 auto; max-width: 400px;">
            <div style="width: ${overallScore}%; background: linear-gradient(90deg, #4caf50, #2196f3); height: 100%; border-radius: 10px; transition: width 0.5s ease;"></div>
          </div>
        </div>
      `;

      analysis.categories.forEach(category => {
        html += `
          <div class="feedback-category ${category.status}">
            <h3>
              <span class="status-icon ${category.status}"></span>
              ${category.name} (${category.score}/100)
            </h3>
            <p style="margin-bottom: 15px;">${category.feedback}</p>
            ${category.suggestions.length > 0 ? `
              <div>
                <strong>Suggestions for improvement:</strong>
                <ul style="margin-top: 10px; padding-left: 20px;">
                  ${category.suggestions.map(suggestion => `<li>${suggestion}</li>`).join('')}
                </ul>
              </div>
            ` : ''}
          </div>
        `;
      });

      feedbackContent.innerHTML = html;
      document.getElementById('feedbackSection').classList.add('show');
      document.getElementById('downloadSection').classList.add('show');
    }

    function downloadResume(type) {
      if (!analysisResults || !resumeData) {
        alert('Please analyze your resume first.');
        return;
      }

      // Show preparation state
      const option = event.target.closest('.download-option');
      const originalText = option.querySelector('.download-btn').textContent;
      
      option.querySelector('.download-btn').textContent = 'Generating Document...';
      option.querySelector('.download-btn').disabled = true;

      // Generate and download the Word document
      setTimeout(async () => {
        try {
          const doc = await generateWordDocument(type, resumeData.content, analysisResults);
          const filename = `improved_resume_${type}_${Date.now()}.docx`;
          
          // Generate and save the document
          const buffer = await docx.Packer.toBlob(doc);
          saveAs(buffer, filename);
          
          // Show success message
          alert(`‚úÖ ${type.charAt(0).toUpperCase() + type.slice(1)} resume downloaded successfully!\n\nFile: ${filename}\n\nThe document includes your original content with improvements based on the analysis results.`);
          
        } catch (error) {
          console.error('Error generating document:', error);
          alert('Error generating document. Please try again.');
        } finally {
          option.querySelector('.download-btn').textContent = originalText;
          option.querySelector('.download-btn').disabled = false;
        }
      }, 500);
    }

    // Generate Word document with different templates
    async function generateWordDocument(template, resumeText, analysis) {
      const { Document, Paragraph, TextRun, HeadingLevel, AlignmentType, UnderlineType, BorderStyle } = docx;
      
      // Extract resume sections from the original text
      const resumeSections = parseResumeText(resumeText);
      
      // Create document based on template type
      let doc;
      
      switch (template) {
        case 'modern':
          doc = createModernTemplate(resumeSections, analysis);
          break;
        case 'classic':
          doc = createClassicTemplate(resumeSections, analysis);
          break;
        case 'original':
        default:
          doc = createOriginalTemplate(resumeSections, analysis);
          break;
      }
      
      return doc;
    }

    // Parse resume text into sections
    function parseResumeText(text) {
      const sections = {
        name: '',
        contact: '',
        summary: '',
        experience: '',
        education: '',
        skills: '',
        other: ''
      };

      const lines = text.split('\n').map(line => line.trim()).filter(line => line);
      let currentSection = 'other';
      
      // Try to identify the name (usually first line or first substantial line)
      if (lines.length > 0) {
        sections.name = lines[0];
      }

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i].toLowerCase();
        
        // Identify sections
        if (line.includes('experience') || line.includes('employment') || line.includes('work history')) {
          currentSection = 'experience';
          continue;
        } else if (line.includes('education') || line.includes('academic')) {
          currentSection = 'education';
          continue;
        } else if (line.includes('skills') || line.includes('competencies') || line.includes('technical')) {
          currentSection = 'skills';
          continue;
        } else if (line.includes('summary') || line.includes('profile') || line.includes('objective')) {
          currentSection = 'summary';
          continue;
        } else if (line.includes('@') || line.includes('phone') || line.includes('email') || line.includes('linkedin')) {
          currentSection = 'contact';
        }

        // Add line to current section
        if (currentSection !== 'other' && i > 0) { // Skip name line
          sections[currentSection] += lines[i] + '\n';
        }
      }

      return sections;
    }

    // Create modern template
    function createModernTemplate(sections, analysis) {
      const { Document, Paragraph, TextRun, HeadingLevel, AlignmentType, UnderlineType } = docx;
      
      const doc = new Document({
        sections: [{
          properties: {},
          children: [
            // Header with name
            new Paragraph({
              alignment: AlignmentType.CENTER,
              children: [
                new TextRun({
                  text: sections.name || "Your Name",
                  bold: true,
                  size: 32,
                  color: "0B4F6C"
                })
              ]
            }),
            
            new Paragraph({ text: "" }), // Spacing
            
            // Contact info
            new Paragraph({
              alignment: AlignmentType.CENTER,
              children: [
                new TextRun({
                  text: sections.contact || "your.email@example.com | (555) 123-4567 | LinkedIn Profile",
                  size: 22
                })
              ]
            }),
            
            new Paragraph({ text: "" }), // Spacing
            
            // Professional Summary
            new Paragraph({
              children: [
                new TextRun({
                  text: "PROFESSIONAL SUMMARY",
                  bold: true,
                  size: 24,
                  color: "0B4F6C"
                })
              ]
            }),
            
            new Paragraph({
              children: [
                new TextRun({
                  text: sections.summary || "Professional summary highlighting key achievements and skills relevant to your target role.",
                  size: 22
                })
              ]
            }),
            
            new Paragraph({ text: "" }), // Spacing
            
            // Experience Section
            new Paragraph({
              children: [
                new TextRun({
                  text: "PROFESSIONAL EXPERIENCE",
                  bold: true,
                  size: 24,
                  color: "0B4F6C"
                })
              ]
            }),
            
            new Paragraph({
              children: [
                new TextRun({
                  text: sections.experience || "Your work experience details here.",
                  size: 22
                })
              ]
            }),
            
            new Paragraph({ text: "" }), // Spacing
            
            // Skills Section
            new Paragraph({
              children: [
                new TextRun({
                  text: "CORE SKILLS",
                  bold: true,
                  size: 24,
                  color: "0B4F6C"
                })
              ]
            }),
            
            new Paragraph({
              children: [
                new TextRun({
                  text: sections.skills || "List your key skills and competencies here.",
                  size: 22
                })
              ]
            }),
            
            new Paragraph({ text: "" }), // Spacing
            
            // Education Section
            new Paragraph({
              children: [
                new TextRun({
                  text: "EDUCATION",
                  bold: true,
                  size: 24,
                  color: "0B4F6C"
                })
              ]
            }),
            
            new Paragraph({
              children: [
                new TextRun({
                  text: sections.education || "Your education details here.",
                  size: 22
                })
              ]
            }),
            
            new Paragraph({ text: "" }), // Spacing
            new Paragraph({ text: "" }), // Spacing
            
            // Analysis Summary
            new Paragraph({
              children: [
                new TextRun({
                  text: "RESUME ANALYSIS SUMMARY",
                  bold: true,
                  size: 20,
                  color: "666666"
                })
              ]
            }),
            
            new Paragraph({
              children: [
                new TextRun({
                  text: `Overall Score: ${analysis.overallScore}/100`,
                  bold: true,
                  size: 20
                })
              ]
            }),
            
            ...analysis.categories.map(category => 
              new Paragraph({
                children: [
                  new TextRun({
                    text: `‚Ä¢ ${category.name}: ${category.score}/100 - ${category.feedback}`,
                    size: 18
                  })
                ]
              })
            )
          ]
        }]
      });
      
      return doc;
    }

    // Create classic template
    function createClassicTemplate(sections, analysis) {
      const { Document, Paragraph, TextRun, HeadingLevel, AlignmentType, UnderlineType } = docx;
      
      const doc = new Document({
        sections: [{
          properties: {},
          children: [
            // Header with name
            new Paragraph({
              alignment: AlignmentType.CENTER,
              children: [
                new TextRun({
                  text: sections.name || "Your Name",
                  bold: true,
                  size: 28,
                  underline: { type: UnderlineType.SINGLE }
                })
              ]
            }),
            
            new Paragraph({ text: "" }), // Spacing
            
            // Contact info
            new Paragraph({
              alignment: AlignmentType.CENTER,
              children: [
                new TextRun({
                  text: sections.contact || "your.email@example.com | (555) 123-4567",
                  size: 22
                })
              ]
            }),
            
            new Paragraph({ text: "" }), // Spacing
            
            // Professional Summary
            new Paragraph({
              children: [
                new TextRun({
                  text: "PROFESSIONAL SUMMARY",
                  bold: true,
                  size: 24,
                  underline: { type: UnderlineType.SINGLE }
                })
              ]
            }),
            
            new Paragraph({
              children: [
                new TextRun({
                  text: sections.summary || "Professional summary highlighting key achievements and skills.",
                  size: 22
                })
              ]
            }),
            
            new Paragraph({ text: "" }), // Spacing
            
            // Experience Section
            new Paragraph({
              children: [
                new TextRun({
                  text: "EXPERIENCE",
                  bold: true,
                  size: 24,
                  underline: { type: UnderlineType.SINGLE }
                })
              ]
            }),
            
            new Paragraph({
              children: [
                new TextRun({
                  text: sections.experience || "Your work experience details here.",
                  size: 22
                })
              ]
            }),
            
            new Paragraph({ text: "" }), // Spacing
            
            // Education Section
            new Paragraph({
              children: [
                new TextRun({
                  text: "EDUCATION",
                  bold: true,
                  size: 24,
                  underline: { type: UnderlineType.SINGLE }
                })
              ]
            }),
            
            new Paragraph({
              children: [
                new TextRun({
                  text: sections.education || "Your education details here.",
                  size: 22
                })
              ]
            }),
            
            new Paragraph({ text: "" }), // Spacing
            
            // Skills Section
            new Paragraph({
              children: [
                new TextRun({
                  text: "SKILLS",
                  bold: true,
                  size: 24,
                  underline: { type: UnderlineType.SINGLE }
                })
              ]
            }),
            
            new Paragraph({
              children: [
                new TextRun({
                  text: sections.skills || "List your key skills here.",
                  size: 22
                })
              ]
            })
          ]
        }]
      });
      
      return doc;
    }

    // Create original format template with improvements
    function createOriginalTemplate(sections, analysis) {
      const { Document, Paragraph, TextRun, HeadingLevel, AlignmentType } = docx;
      
      const doc = new Document({
        sections: [{
          properties: {},
          children: [
            // Original content with improvements note
            new Paragraph({
              alignment: AlignmentType.CENTER,
              children: [
                new TextRun({
                  text: "IMPROVED RESUME",
                  bold: true,
                  size: 24
                })
              ]
            }),
            
            new Paragraph({ text: "" }), // Spacing
            
            new Paragraph({
              children: [
                new TextRun({
                  text: sections.name || "Your Name",
                  bold: true,
                  size: 28
                })
              ]
            }),
            
            new Paragraph({ text: "" }), // Spacing
            
            new Paragraph({
              children: [
                new TextRun({
                  text: sections.contact || "Contact Information",
                  size: 22
                })
              ]
            }),
            
            new Paragraph({ text: "" }), // Spacing
            
            new Paragraph({
              children: [
                new TextRun({
                  text: "PROFESSIONAL SUMMARY",
                  bold: true,
                  size: 20
                })
              ]
            }),
            
            new Paragraph({
              children: [
                new TextRun({
                  text: sections.summary || "Enhanced professional summary based on analysis feedback.",
                  size: 20
                })
              ]
            }),
            
            new Paragraph({ text: "" }), // Spacing
            
            new Paragraph({
              children: [
                new TextRun({
                  text: "EXPERIENCE",
                  bold: true,
                  size: 20
                })
              ]
            }),
            
            new Paragraph({
              children: [
                new TextRun({
                  text: sections.experience || "Your enhanced work experience with improved formatting and content.",
                  size: 20
                })
              ]
            }),
            
            new Paragraph({ text: "" }), // Spacing
            
            new Paragraph({
              children: [
                new TextRun({
                  text: "SKILLS",
                  bold: true,
                  size: 20
                })
              ]
            }),
            
            new Paragraph({
              children: [
                new TextRun({
                  text: sections.skills || "Enhanced skills section with better organization.",
                  size: 20
                })
              ]
            }),
            
            new Paragraph({ text: "" }), // Spacing
            
            new Paragraph({
              children: [
                new TextRun({
                  text: "EDUCATION",
                  bold: true,
                  size: 20
                })
              ]
            }),
            
            new Paragraph({
              children: [
                new TextRun({
                  text: sections.education || "Your education information with improvements.",
                  size: 20
                })
              ]
            }),
            
            new Paragraph({ text: "" }), // Spacing
            new Paragraph({ text: "" }), // Spacing
            
            // Improvement suggestions
            new Paragraph({
              children: [
                new TextRun({
                  text: "IMPROVEMENT SUGGESTIONS APPLIED:",
                  bold: true,
                  size: 18,
                  color: "0B4F6C"
                })
              ]
            }),
            
            ...analysis.categories.flatMap(category => 
              category.suggestions.map(suggestion =>
                new Paragraph({
                  children: [
                    new TextRun({
                      text: `‚Ä¢ ${suggestion}`,
                      size: 16
                    })
                  ]
                })
              )
            )
          ]
        }]
      });
      
      return doc;
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      // Any initialization code here
      console.log('Resume Analyzer page loaded');
    });
  </script>
</body>
</html>
