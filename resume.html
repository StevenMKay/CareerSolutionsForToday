<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Resume Analyzer - Career Solutions for Today</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="site.css">
  <style>
    /* Resume page specific styles */
    .resume-container {
      max-width: 1200px;
      margin: 110px auto 0 auto;
      padding: 30px 20px 60px 20px;
    }

    .resume-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .resume-header h1 {
      color: white;
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .resume-header p {
      color: white;
      font-size: 1.2em;
      opacity: 0.9;
    }

    .upload-section {
      background: rgba(255,255,255,0.15);
      border-radius: 18px;
      box-shadow: 0 2px 18px rgba(0,0,0,0.13);
      padding: 40px;
      margin-bottom: 30px;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      color: white;
    }

    .upload-methods {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }

    .upload-method {
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      border: 2px dashed rgba(255,255,255,0.3);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .upload-method:hover {
      border-color: rgba(255,255,255,0.6);
      background: rgba(255,255,255,0.2);
    }

    .upload-method h3 {
      color: white;
      margin-bottom: 15px;
      font-size: 1.3em;
    }

    .file-upload {
      position: relative;
      display: inline-block;
      width: 100%;
    }

    .file-upload input[type=file] {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    .upload-btn {
      background: #0b4f6c;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
      width: 100%;
    }

    .upload-btn:hover {
      background: #0a4460;
    }

    .drag-drop-area {
      border: 2px dashed rgba(255,255,255,0.4);
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      margin: 20px 0;
      transition: all 0.3s ease;
    }

    .drag-drop-area.dragover {
      border-color: #0b4f6c;
      background: rgba(11,79,108,0.1);
    }

    .text-input-section {
      grid-column: 1 / -1;
    }

    .resume-textarea {
      width: 100%;
      min-height: 200px;
      padding: 15px;
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 8px;
      background: rgba(255,255,255,0.1);
      color: white;
      font-size: 14px;
      font-family: 'Segoe UI', sans-serif;
      resize: vertical;
    }

    .resume-textarea::placeholder {
      color: rgba(255,255,255,0.7);
    }

    .analyze-btn {
      background: linear-gradient(45deg, #0b4f6c, #1976d2);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
      margin-top: 20px;
      transition: all 0.3s ease;
      display: block;
      margin: 20px auto 0 auto;
    }

    .analyze-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(11,79,108,0.4);
    }

    .analyze-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .feedback-section {
      background: rgba(255,255,255,0.15);
      border-radius: 18px;
      box-shadow: 0 2px 18px rgba(0,0,0,0.13);
      padding: 40px;
      margin-bottom: 30px;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      color: white;
      display: none;
    }

    .feedback-section.show {
      display: block;
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .feedback-category {
      margin-bottom: 25px;
      padding: 20px;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      border-left: 4px solid #1976d2;
    }

    .feedback-category h3 {
      color: white;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .feedback-category.good {
      border-left-color: #4caf50;
    }

    .feedback-category.warning {
      border-left-color: #ff9800;
    }

    .feedback-category.critical {
      border-left-color: #f44336;
    }

    .status-icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: inline-block;
    }

    .status-icon.good { background: #4caf50; }
    .status-icon.warning { background: #ff9800; }
    .status-icon.critical { background: #f44336; }

    .download-section {
      background: rgba(255,255,255,0.15);
      border-radius: 18px;
      box-shadow: 0 2px 18px rgba(0,0,0,0.13);
      padding: 40px;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      color: white;
      display: none;
    }

    .download-section.show {
      display: block;
      animation: fadeIn 0.5s ease-in;
    }

    .download-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .download-option {
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 25px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .download-option:hover {
      background: rgba(255,255,255,0.2);
      transform: translateY(-3px);
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    }

    .download-option h4 {
      color: white;
      margin-bottom: 10px;
      font-size: 1.2em;
    }

    .download-option p {
      color: rgba(255,255,255,0.8);
      font-size: 0.9em;
      margin-bottom: 15px;
    }

    .download-btn {
      background: #0b4f6c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }

    .download-btn:hover {
      background: #0a4460;
    }

    .progress-bar {
      width: 100%;
      height: 4px;
      background: rgba(255,255,255,0.2);
      border-radius: 2px;
      margin: 20px 0;
      overflow: hidden;
      display: none;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #0b4f6c, #1976d2);
      width: 0%;
      transition: width 0.3s ease;
    }

    @media (max-width: 768px) {
      .upload-methods {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .resume-container {
        padding: 20px 15px;
      }

      .upload-section, .feedback-section, .download-section {
        padding: 25px;
      }

      .resume-header h1 {
        font-size: 2em;
      }

      .text-input-section {
        grid-column: 1 / -1;
      }
    }
  </style>
</head>

<body>
  <nav class="navbar">
    <ul class="nav-links" id="navLinks">
       <li><a href="index.html">Home</a></li>
    <li><a href="Videos.html">Videos</a></li>
    <li><a href="Templates.html">Templates</a></li>
    <li><a href="Learn.html" class="learn-underline">Learn</a></li>
    <li><a href="resume.html" class="resume-underline">Resume</a></li>
    <li><a href="AboutMe.html" class="about-underline">About Me</a></li>
    </ul>
    <div class="nav-logo">Career Solutions for Today</div>
    <div class="hamburger" id="hamburgerBtn" aria-label="Open navigation" tabindex="0">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </nav>

  <div class="resume-container">
    <div class="resume-header">
      <h1>AI-Powered Resume Analyzer</h1>
      <p>Upload your resume and get instant feedback to land your dream job</p>
    </div>

    <div class="upload-section">
      <h2 style="color: white; text-align: center; margin-bottom: 30px;">Upload Your Resume</h2>
      
      <div class="upload-methods">
        <div class="upload-method">
          <h3>üìÑ Upload File</h3>
          <p>Upload your resume in PDF, DOC, or DOCX format</p>
          <div class="file-upload">
            <input type="file" id="fileInput" accept=".pdf,.doc,.docx" />
            <button class="upload-btn">Choose File</button>
          </div>
        </div>

        <div class="upload-method" id="dragDropArea">
          <h3>üéØ Drag & Drop</h3>
          <p>Drag your resume file here for quick upload</p>
          <div class="drag-drop-area">
            <p>Drop your file here</p>
          </div>
        </div>

        <div class="text-input-section upload-method">
          <h3>üìù Copy & Paste Resume</h3>
          <p>Paste your resume text directly into the box below</p>
          <textarea 
            class="resume-textarea" 
            id="resumeText" 
            placeholder="Paste your resume text here...&#10;&#10;Include all sections: Contact info, Summary, Experience, Education, Skills, etc."
          ></textarea>
        </div>

        <div class="text-input-section upload-method">
          <h3>üéØ Job Description (Optional)</h3>
          <p>Paste the job description you're applying for to get targeted feedback</p>
          <textarea 
            class="resume-textarea" 
            id="jobDescriptionText" 
            style="min-height: 150px;"
            placeholder="Paste the job description here (optional)...&#10;&#10;Include: Job title, requirements, responsibilities, preferred skills, etc.&#10;&#10;This helps tailor the analysis to match what employers are looking for!"
          ></textarea>
        </div>
      </div>

      <div class="progress-bar" id="progressBar">
        <div class="progress-fill" id="progressFill"></div>
      </div>

      <button class="analyze-btn" id="analyzeBtn" disabled>
        üîç Analyze My Resume
      </button>
    </div>

    <div class="feedback-section" id="feedbackSection">
      <h2 style="color: white; text-align: center; margin-bottom: 30px;">Resume Analysis Results</h2>
      <div id="feedbackContent"></div>
    </div>

    <div class="download-section" id="downloadSection">
      <h2 style="color: white; text-align: center; margin-bottom: 20px;">Download Improved Resume</h2>
      <p style="text-align: center; margin-bottom: 30px;">Choose your preferred resume template and download the improved version</p>
      
      <div class="download-options">
        <div class="download-option" onclick="downloadResume('modern')">
          <h4>üé® Modern Resume</h4>
          <p>Contemporary design with color accents and modern layout. Perfect for creative and tech roles.</p>
          <button class="download-btn">Download Modern (.docx)</button>
        </div>

        <div class="download-option" onclick="downloadResume('classic')">
          <h4>üìã Classic Resume</h4>
          <p>Traditional black and white format. Ideal for conservative industries and formal positions.</p>
          <button class="download-btn">Download Classic (.docx)</button>
        </div>

        <div class="download-option" onclick="downloadResume('original')">
          <h4>üîÑ Same Format</h4>
          <p>Keep your original format but with improved content based on our suggestions.</p>
          <button class="download-btn">Download Improved (.docx)</button>
        </div>
      </div>
    </div>
  </div>

  <script src="js/backgrounds.js"></script>
  <script src="js/universalSidebar.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
  
  <script>
    let resumeData = null;
    let analysisResults = null;

    // üîí Backend URL (API key is safely stored on server)
    const BACKEND_URL = 'https://resume-analyzer-backend-pi.vercel.app/api/analyze';

    // üí∞ Usage tracking (hidden but still functional)
    const MONTHLY_BUDGET_LIMIT = 20.00;
    const COST_PER_ANALYSIS = 0.01;
    
    // Hidden usage tracking functions (no UI display)
    function getUsageData() {
      const currentMonth = new Date().toISOString().slice(0, 7);
      const stored = localStorage.getItem('resumeAnalyzer_usage');
      
      if (!stored) {
        return { month: currentMonth, count: 0, cost: 0 };
      }
      
      const data = JSON.parse(stored);
      
      if (data.month !== currentMonth) {
        return { month: currentMonth, count: 0, cost: 0 };
      }
      
      return data;
    }
    
    function updateUsageData() {
      const currentMonth = new Date().toISOString().slice(0, 7);
      const usage = getUsageData();
      
      usage.month = currentMonth;
      usage.count += 1;
      usage.cost += COST_PER_ANALYSIS;
      
      localStorage.setItem('resumeAnalyzer_usage', JSON.stringify(usage));
      
      // Log usage for admin tracking (hidden from users)
      console.log(`Usage Update: ${usage.count} analyses, $${usage.cost.toFixed(2)} cost this month`);
      
      return usage;
    }
    
    function checkBudgetLimit() {
      const usage = getUsageData();
      return usage.cost < MONTHLY_BUDGET_LIMIT;
    }

    // File upload handling
    document.getElementById('fileInput').addEventListener('change', handleFileUpload);
    
    // Drag and drop handling
    const dragDropArea = document.getElementById('dragDropArea');
    dragDropArea.addEventListener('dragover', handleDragOver);
    dragDropArea.addEventListener('drop', handleFileDrop);
    dragDropArea.addEventListener('dragleave', handleDragLeave);

    // Text input handling
    document.getElementById('resumeText').addEventListener('input', handleTextInput);

    // Analyze button
    document.getElementById('analyzeBtn').addEventListener('click', analyzeResume);

    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (file) {
        processFile(file);
      }
    }

    function handleDragOver(event) {
      event.preventDefault();
      dragDropArea.classList.add('dragover');
    }

    function handleDragLeave(event) {
      event.preventDefault();
      dragDropArea.classList.remove('dragover');
    }

    function handleFileDrop(event) {
      event.preventDefault();
      dragDropArea.classList.remove('dragover');
      
      const files = event.dataTransfer.files;
      if (files.length > 0) {
        processFile(files[0]);
      }
    }

    function handleTextInput(event) {
      const text = event.target.value.trim();
      if (text.length > 50) {
        resumeData = { type: 'text', content: text };
        document.getElementById('analyzeBtn').disabled = false;
      } else {
        document.getElementById('analyzeBtn').disabled = true;
      }
    }

    async function processFile(file) {
      const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
      
      if (!allowedTypes.includes(file.type)) {
        alert('Please upload a PDF, DOC, or DOCX file.');
        return;
      }

      // Show progress bar
      const progressBar = document.getElementById('progressBar');
      const progressFill = document.getElementById('progressFill');
      progressBar.style.display = 'block';

      try {
        let extractedText = '';

        if (file.type === 'application/pdf') {
          extractedText = await extractTextFromPDF(file);
        } else if (file.type.includes('word') || file.type.includes('document')) {
          extractedText = await extractTextFromWord(file);
        }

        // Simulate progress
        let progress = 0;
        const interval = setInterval(() => {
          progress += 10;
          progressFill.style.width = progress + '%';
          
          if (progress >= 100) {
            clearInterval(interval);
            setTimeout(() => {
              progressBar.style.display = 'none';
              progressFill.style.width = '0%';
              
              if (extractedText.trim().length > 50) {
                resumeData = { type: 'file', content: extractedText, filename: file.name };
                document.getElementById('analyzeBtn').disabled = false;
                alert(`File "${file.name}" processed successfully! ${extractedText.length} characters extracted. Click "Analyze My Resume" to continue.`);
              } else {
                alert('Could not extract enough text from the file. Please try a different file or use copy/paste method.');
              }
            }, 500);
          }
        }, 200);

      } catch (error) {
        progressBar.style.display = 'none';
        alert('Error processing file: ' + error.message);
      }
    }

    async function extractTextFromPDF(file) {
      const arrayBuffer = await file.arrayBuffer();
      const pdf = await PDFLib.PDFDocument.load(arrayBuffer);
      const pages = pdf.getPages();
      
      let text = '';
      // Note: PDFLib doesn't extract text directly, this is a simplified version
      // In a real app, you'd use pdf-parse or similar library
      text = "PDF text extraction requires server-side processing. Please copy and paste your resume text instead, or upload a Word document.";
      return text;
    }

    async function extractTextFromWord(file) {
      const arrayBuffer = await file.arrayBuffer();
      const result = await mammoth.extractRawText({ arrayBuffer: arrayBuffer });
      return result.value;
    }

    async function analyzeResume() {
      if (!resumeData) {
        alert('Please upload a resume or paste resume text first.');
        return;
      }

      // Check budget limit (hidden tracking)
      if (!checkBudgetLimit()) {
        const usage = getUsageData();
        alert(`üí∞ Monthly analysis limit reached!\n\nPlease try again next month. This protects against unexpected usage costs.`);
        return;
      }

      // Get job description (optional)
      const jobDescription = document.getElementById('jobDescriptionText').value.trim();

      // Show analyzing state
      const analyzeBtn = document.getElementById('analyzeBtn');
      analyzeBtn.textContent = jobDescription ? 
        'üîÑ Analyzing Resume vs Job Description...' : 
        'üîÑ Analyzing Resume...';
      analyzeBtn.disabled = true;

      try {
        const analysis = await performAIResumeAnalysis(resumeData.content, jobDescription);
        
        // Update usage tracking (hidden)
        updateUsageData();
        
        displayAnalysisResults(analysis, !!jobDescription);
        
        // Scroll to results
        document.getElementById('feedbackSection').scrollIntoView({ behavior: 'smooth' });
      } catch (error) {
        alert('Error analyzing resume: ' + error.message + '\n\nPlease try again. No usage counted for failed attempts.');
        console.error('Analysis error:', error);
      } finally {
        analyzeBtn.textContent = 'üîç Analyze My Resume';
        analyzeBtn.disabled = false;
      }
    }

    async function performAIResumeAnalysis(resumeText, jobDescription = '') {
      try {
        const response = await fetch(BACKEND_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            resumeText: resumeText,
            jobDescription: jobDescription
          })
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(`Backend Error: ${errorData.message || 'Unknown error'}`);
        }

        const data = await response.json();
        
        if (!data.success) {
          throw new Error('Analysis failed');
        }

        return data.analysis;
      } catch (error) {
        // If backend is down, show helpful error
        if (error.message.includes('fetch')) {
          throw new Error('Unable to connect to analysis service. Please try again in a moment.');
        }
        throw error;
      }
    }

    function displayAnalysisResults(analysis, hasJobDescription = false) {
      analysisResults = analysis;
      
      const feedbackContent = document.getElementById('feedbackContent');
      const overallScore = analysis.overallScore;
      
      let html = `
        <div style="text-align: center; margin-bottom: 30px;">
          <h3 style="color: white; font-size: 2em; margin-bottom: 10px;">Overall Score: ${overallScore}/100</h3>
          ${hasJobDescription ? '<p style="color: #00ff00; margin-bottom: 10px;">‚úÖ Analyzed against job description</p>' : ''}
          <div style="width: 100%; background: rgba(255,255,255,0.2); border-radius: 10px; height: 20px; margin: 0 auto; max-width: 400px;">
            <div style="width: ${overallScore}%; background: linear-gradient(90deg, #4caf50, #2196f3); height: 100%; border-radius: 10px; transition: width 0.5s ease;"></div>
          </div>
        </div>
      `;

      analysis.categories.forEach(category => {
        html += `
          <div class="feedback-category ${category.status}">
            <h3>
              <span class="status-icon ${category.status}"></span>
              ${category.name} (${category.score}/100)
            </h3>
            <p style="margin-bottom: 15px;">${category.feedback}</p>
            ${category.suggestions.length > 0 ? `
              <div>
                <strong>Suggestions for improvement:</strong>
                <ul style="margin-top: 10px; padding-left: 20px;">
                  ${category.suggestions.map(suggestion => `<li>${suggestion}</li>`).join('')}
                </ul>
              </div>
            ` : ''}
          </div>
        `;
      });

      feedbackContent.innerHTML = html;
      document.getElementById('feedbackSection').classList.add('show');
      document.getElementById('downloadSection').classList.add('show');
    }

    function downloadResume(type) {
      if (!analysisResults) {
        alert('Please analyze your resume first.');
        return;
      }

      // Simulate download preparation
      const option = event.target.closest('.download-option');
      const originalText = option.querySelector('.download-btn').textContent;
      
      option.querySelector('.download-btn').textContent = 'Preparing...';
      option.querySelector('.download-btn').disabled = true;

      setTimeout(() => {
        // In a real application, this would generate and download the actual Word document
        const filename = `improved_resume_${type}_${Date.now()}.docx`;
        
        // Create a mock download
        const link = document.createElement('a');
        link.href = '#';
        link.download = filename;
        
        alert(`Your ${type} resume would be downloaded as: ${filename}\n\nNote: This is a demo. In the full version, a professionally formatted Word document would be generated with your improvements.`);
        
        option.querySelector('.download-btn').textContent = originalText;
        option.querySelector('.download-btn').disabled = false;
      }, 2000);
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      // Any initialization code here
      console.log('Resume Analyzer page loaded');
    });
  </script>
</body>
</html>
