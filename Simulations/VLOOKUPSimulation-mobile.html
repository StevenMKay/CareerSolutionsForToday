<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VLOOKUP Master Training - Mobile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
            font-size: 13px;
            line-height: 1.3;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #0b4f6c, #1a73e8);
            color: white;
            padding: 12px 16px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .header p {
            font-size: 12px;
            opacity: 0.9;
        }
        
        /* Progress bar */
        .progress-section {
            background: white;
            padding: 12px 16px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .progress-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 6px;
            text-align: center;
            font-weight: 600;
        }
        
        .progress-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #34a853, #0f9d58);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        /* Main container */
        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Excel area */
        .excel-area {
            background: white;
            border-bottom: 2px solid #e9ecef;
            flex: 0 0 45%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .excel-header {
            background: #f8f9fa;
            padding: 8px 12px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .excel-title {
            font-size: 14px;
            font-weight: 600;
            color: #1a73e8;
        }
        
        .add-data-btn {
            background: linear-gradient(135deg, #34a853, #0f9d58);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .add-data-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(52, 168, 83, 0.3);
        }
        
        /* Formula bar */
        .formula-bar {
            background: #f8f9fa;
            padding: 8px 12px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
        }
        
        .formula-bar::after {
            content: "💡 You can type the formula here OR use the step buttons below";
            position: absolute;
            top: -16px;
            left: 12px;
            font-size: 10px;
            color: #666;
            background: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid #e9ecef;
        }
        
        .cell-ref {
            background: white;
            border: 1px solid #dadce0;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: 600;
            color: #1a73e8;
            min-width: 40px;
            text-align: center;
        }
        
        .fx-btn {
            background: #1a73e8;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            cursor: pointer;
        }
        
        .formula-input {
            flex: 1;
            border: 1px solid #dadce0;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background: white;
            transition: all 0.2s ease;
        }
        
        .formula-input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }
        
        .formula-input::placeholder {
            color: #9ca3af;
            font-style: italic;
        }
        
        /* Excel grid */
        .excel-grid-container {
            flex: 1;
            overflow: auto;
            background: white;
        }
        
        .excel-grid {
            border-collapse: collapse;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 11px;
            min-width: 100%;
        }
        
        .excel-grid th,
        .excel-grid td {
            border: 1px solid #d1d5db;
            padding: 4px 6px;
            text-align: left;
            height: 28px;
            min-width: 60px;
        }
        
        .excel-grid th {
            background: #f8f9fa;
            font-weight: 600;
            color: #374151;
            text-align: center;
            font-size: 10px;
        }
        
        .excel-grid .row-header {
            background: #f8f9fa;
            font-weight: 600;
            color: #374151;
            text-align: center;
            width: 30px;
            min-width: 30px;
        }
        
        .excel-grid td {
            cursor: cell;
            position: relative;
        }
        
        .excel-grid td:hover {
            background: #f0f9ff;
        }
        
        .excel-grid td.selected {
            background: #dbeafe;
            outline: 2px solid #3b82f6;
        }
        
        /* Training area */
        .training-area {
            flex: 0 0 55%;
            background: white;
            overflow-y: auto;
            padding: 16px;
        }
        
        .step-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }
        
        .step-card.active {
            border-color: #1a73e8;
            background: #f0f9ff;
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.15);
        }
        
        .step-card.completed {
            border-color: #34a853;
            background: #f0fdf4;
            position: relative;
        }
        
        .step-card.completed::after {
            content: "✅ Step Complete";
            position: absolute;
            top: 12px;
            right: 12px;
            background: #34a853;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            gap: 10px;
        }
        
        .step-number {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #1a73e8, #1557b0);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 13px;
            flex-shrink: 0;
        }
        
        .step-number.completed {
            background: linear-gradient(135deg, #34a853, #0f9d58);
        }
        
        .step-title {
            font-size: 15px;
            font-weight: 600;
            color: #1f2937;
            flex: 1;
        }
        
        .step-description {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 12px;
            line-height: 1.4;
        }
        
        .step-instruction {
            background: #e0f2fe;
            border: 1px solid #b3e5fc;
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 12px;
            color: #0d47a1;
            margin-bottom: 12px;
            font-weight: 500;
            line-height: 1.3;
        }
        
        .step-action {
            background: linear-gradient(135deg, #34a853, #0f9d58);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .step-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(52, 168, 83, 0.3);
        }
        
        .step-action:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* Sample data styles */
        .highlight-column {
            background: #fef3c7 !important;
        }
        
        .highlight-lookup {
            background: #dcfce7 !important;
        }
        
        .highlight-result {
            background: #fee2e2 !important;
        }
        
        /* Completion message */
        .completion-message {
            background: linear-gradient(135deg, #34a853, #0f9d58);
            color: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 12px;
            font-weight: 600;
            display: none;
        }
        
        .completion-message.show {
            display: block;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>📊 VLOOKUP Master Training</h1>
        <p>Learn Excel VLOOKUP function formula step by step</p>
    </div>
    
    <div class="progress-section">
        <div class="progress-label">Progress: <span id="progress-text">0% Complete</span></div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
    </div>
    
    <div class="main-container">
        <!-- Excel Area -->
        <div class="excel-area">
            <div class="excel-header">
                <div class="excel-title">📈 Excel Workspace</div>
                <button class="add-data-btn" onclick="addSampleData()" id="add-data-btn">ADD SAMPLE DATA</button>
            </div>
            
            <div class="formula-bar">
                <div class="cell-ref" id="cell-ref">A1</div>
                <button class="fx-btn">fx</button>
                <input type="text" class="formula-input" id="formula-input" placeholder="Type formula here or use step buttons below...">
            </div>
            
            <div class="excel-grid-container">
                <table class="excel-grid" id="excel-grid">
                    <thead>
                        <tr>
                            <th></th>
                            <th>A</th>
                            <th>B</th>
                            <th>C</th>
                            <th>D</th>
                            <th>E</th>
                        </tr>
                    </thead>
                    <tbody id="excel-body">
                        <!-- Rows will be generated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Training Area -->
        <div class="training-area">
            <!-- Step 1: Add Sample Data -->
            <div class="step-card active" id="step-1">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div class="step-title">Add Sample Data</div>
                </div>
                <div class="step-description">
                    Let's start by adding employee data to work with. This creates our lookup table that VLOOKUP will search through.
                </div>
                <div class="step-instruction">
                    👇 Click the "ADD SAMPLE DATA" button above to populate the spreadsheet with employee information
                </div>
                <div class="completion-message" id="step-1-complete">
                    ✅ Sample data added successfully! Now we can proceed to the next step.
                </div>
                <button class="step-action" onclick="addSampleData()" id="step-1-btn">Add Sample Data</button>
            </div>
            
            <!-- Step 2: Select Result Cell -->
            <div class="step-card" id="step-2">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <div class="step-title">Select Result Cell</div>
                </div>
                <div class="step-description">
                    Choose where our VLOOKUP result will appear. We'll look up the employee name for the ID in D2.
                </div>
                <div class="step-instruction">
                    👆 Click on cell E2 in the Excel grid above - this is where our VLOOKUP result will appear
                </div>
                <div class="completion-message" id="step-2-complete">
                    ✅ Perfect! Cell E2 selected. Ready to start building the VLOOKUP formula.
                </div>
                <button class="step-action" onclick="selectCell('E', 2)" id="step-2-btn" disabled>Select Cell E2</button>
            </div>
            
            <!-- Step 3: Start VLOOKUP Formula -->
            <div class="step-card" id="step-3">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <div class="step-title">Start VLOOKUP Formula</div>
                </div>
                <div class="step-description">
                    VLOOKUP is Excel's most powerful lookup function. It searches the first column of a table for a value. Every formula starts with an equals sign.
                </div>
                <div class="step-instruction">
                    💡 Type in the formula bar: =VLOOKUP( OR click the button below
                </div>
                <div class="completion-message" id="step-3-complete">
                    ✅ Great start! You've opened the VLOOKUP function. Now let's add the lookup value.
                </div>
                <button class="step-action" onclick="startVLOOKUP()" id="step-3-btn" disabled>Start VLOOKUP</button>
            </div>
            
            <!-- Step 4: Enter Lookup Value -->
            <div class="step-card" id="step-4">
                <div class="step-header">
                    <div class="step-number">4</div>
                    <div class="step-title">Enter Lookup Value</div>
                </div>
                <div class="step-description">
                    The first argument is what we're looking for. We want to find the name for the employee ID in cell D2.
                </div>
                <div class="step-instruction">
                    ⌨️ Continue typing in the formula bar: D2, OR click the button below
                </div>
                <div class="completion-message" id="step-4-complete">
                    ✅ Lookup value added! Now we need to specify the table range to search in.
                </div>
                <button class="step-action" onclick="addLookupValue()" id="step-4-btn" disabled>Add Lookup Value</button>
            </div>
            
            <!-- Step 5: Define Table Array -->
            <div class="step-card" id="step-5">
                <div class="step-header">
                    <div class="step-number">5</div>
                    <div class="step-title">Define Table Array</div>
                </div>
                <div class="step-description">
                    The table array tells VLOOKUP where to search. Our employee data is in columns A:B, rows 2-6.
                </div>
                <div class="step-instruction">
                    ⌨️ Continue typing: A2:B6, OR click the button below
                </div>
                <div class="completion-message" id="step-5-complete">
                    ✅ Table range defined! Now specify which column to return data from.
                </div>
                <button class="step-action" onclick="addTableArray()" id="step-5-btn" disabled>Add Table Array</button>
            </div>
            
            <!-- Step 6: Set Column Index -->
            <div class="step-card" id="step-6">
                <div class="step-header">
                    <div class="step-number">6</div>
                    <div class="step-title">Set Column Index</div>
                </div>
                <div class="step-description">
                    Column index specifies which column to return. Column A=1, Column B=2. We want names from column B.
                </div>
                <div class="step-instruction">
                    ⌨️ Continue typing: 2, OR click the button below
                </div>
                <div class="completion-message" id="step-6-complete">
                    ✅ Column index set! Almost done - just need to set the match type.
                </div>
                <button class="step-action" onclick="addColumnIndex()" id="step-6-btn" disabled>Add Column Index</button>
            </div>
            
            <!-- Step 7: Set Exact Match -->
            <div class="step-card" id="step-7">
                <div class="step-header">
                    <div class="step-number">7</div>
                    <div class="step-title">Set Exact Match</div>
                </div>
                <div class="step-description">
                    The last argument controls match type. FALSE means exact match - safer for most lookups.
                </div>
                <div class="step-instruction">
                    ⌨️ Finish typing: FALSE) OR click the button below
                </div>
                <div class="completion-message" id="step-7-complete">
                    ✅ Formula complete! Ready to execute and see the magic happen.
                </div>
                <button class="step-action" onclick="addExactMatch()" id="step-7-btn" disabled>Set Exact Match</button>
            </div>
            
            <!-- Step 8: Execute Formula -->
            <div class="step-card" id="step-8">
                <div class="step-header">
                    <div class="step-number">8</div>
                    <div class="step-title">Execute the Formula</div>
                </div>
                <div class="step-description">
                    Perfect! Your VLOOKUP is complete. Press Enter to execute it and see the magic happen!
                </div>
                <div class="step-instruction">
                    ⏎ Press Enter or click Execute to run your VLOOKUP formula
                </div>
                <div class="completion-message" id="step-8-complete">
                    ✅ VLOOKUP executed successfully! The formula found the matching employee name.
                </div>
                <button class="step-action" onclick="executeFormula()" id="step-8-btn" disabled>Execute Formula</button>
            </div>
            
            <!-- Step 9: Understand the Result -->
            <div class="step-card" id="step-9">
                <div class="step-header">
                    <div class="step-number">9</div>
                    <div class="step-title">Understand the Result</div>
                </div>
                <div class="step-description">
                    Excellent! VLOOKUP searched for ID "103" in column A and returned "Alice Johnson" from column B. This is how data lookup works!
                </div>
                <div class="step-instruction">
                    🧠 Notice how VLOOKUP found the exact match and returned the corresponding value from the second column
                </div>
                <div class="completion-message" id="step-9-complete">
                    ✅ You understand how VLOOKUP works! Let's try changing the lookup value.
                </div>
                <button class="step-action" onclick="understandResult()" id="step-9-btn" disabled>I Understand!</button>
            </div>
            
            <!-- Step 10: Try Different Values -->
            <div class="step-card" id="step-10">
                <div class="step-header">
                    <div class="step-number">10</div>
                    <div class="step-title">Try Different Lookup Values</div>
                </div>
                <div class="step-description">
                    Let's test your VLOOKUP with different employee IDs! Change the value in D2 to see how VLOOKUP adapts.
                </div>
                <div class="step-instruction">
                    🔄 Click on cell D2 and change it to "101" to see John Smith's name appear in E2
                </div>
                <div class="completion-message" id="step-10-complete">
                    ✅ Excellent! You've tested VLOOKUP with a different value and seen how it adapts.
                </div>
                <button class="step-action" onclick="tryDifferentValues()" id="step-10-btn" disabled>Change D2 to "101"</button>
            </div>
            
            <!-- Step 11: Test Edge Cases -->
            <div class="step-card" id="step-11">
                <div class="step-header">
                    <div class="step-number">11</div>
                    <div class="step-title">Test Edge Cases</div>
                </div>
                <div class="step-description">
                    Let's see what happens when VLOOKUP can't find a match. Try entering an ID that doesn't exist in our data.
                </div>
                <div class="step-instruction">
                    ❌ Try changing D2 to "999" (a non-existent ID) to see VLOOKUP's error handling
                </div>
                <div class="completion-message" id="step-11-complete">
                    ✅ Perfect! You've seen how VLOOKUP handles missing data with #N/A error.
                </div>
                <button class="step-action" onclick="testEdgeCases()" id="step-11-btn" disabled>Test #N/A Error</button>
            </div>
            
            <!-- Step 12: VLOOKUP Master! -->
            <div class="step-card" id="step-12">
                <div class="step-header">
                    <div class="step-number">12</div>
                    <div class="step-title">🎉 VLOOKUP Master!</div>
                </div>
                <div class="step-description">
                    Congratulations! You've mastered VLOOKUP - one of Excel's most powerful functions. You can now build complex lookup formulas with confidence!
                </div>
                <div class="step-instruction">
                    🏆 You've learned: formula syntax, table arrays, column indexes, exact matching, error handling, and practical applications!
                </div>
                <div class="completion-message" id="step-12-complete">
                    ✅ Training Complete! You are now a VLOOKUP expert.
                </div>
                <button class="step-action" onclick="restartTutorial()" id="step-12-btn" disabled>Start Over</button>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let selectedCell = null;
        let hasData = false;
        let formulaSteps = {
            vlookup: false,
            lookupValue: false,
            tableArray: false,
            columnIndex: false,
            exactMatch: false,
            executed: false
        };
        
        // Employee data for lookup simulation
        const employeeData = {
            '101': 'John Smith',
            '102': 'Sarah Davis', 
            '103': 'Alice Johnson',
            '104': 'Michael Brown',
            '105': 'Emily Wilson'
        };
        
        // Initialize Excel grid
        function initializeGrid() {
            const tbody = document.getElementById('excel-body');
            tbody.innerHTML = '';
            
            for (let i = 1; i <= 10; i++) {
                const row = document.createElement('tr');
                
                // Row header
                const rowHeader = document.createElement('td');
                rowHeader.className = 'row-header';
                rowHeader.textContent = i;
                row.appendChild(rowHeader);
                
                // Data cells
                ['A', 'B', 'C', 'D', 'E'].forEach(col => {
                    const cell = document.createElement('td');
                    cell.id = `${col}${i}`;
                    cell.onclick = () => selectCellById(col, i);
                    row.appendChild(cell);
                });
                
                tbody.appendChild(row);
            }
        }
        
        function addSampleData() {
            console.log('📊 Adding sample data...');
            
            const sampleData = [
                ['Employee ID', 'Employee Name', '', 'Search ID', 'Result'],
                ['101', 'John Smith', '', '103', ''],
                ['102', 'Sarah Davis', '', '', ''],
                ['103', 'Alice Johnson', '', '', ''],
                ['104', 'Michael Brown', '', '', ''],
                ['105', 'Emily Wilson', '', '', '']
            ];
            
            sampleData.forEach((rowData, rowIndex) => {
                rowData.forEach((cellData, colIndex) => {
                    const colLetter = String.fromCharCode(65 + colIndex);
                    const cell = document.getElementById(`${colLetter}${rowIndex + 1}`);
                    if (cell) {
                        cell.textContent = cellData;
                        if (rowIndex === 0) {
                            cell.style.fontWeight = 'bold';
                            cell.style.background = '#e5e7eb';
                        }
                    }
                });
            });
            
            hasData = true;
            console.log('✅ Sample data added successfully');
            
            // Complete step 1 with a small delay to ensure DOM is updated
            setTimeout(() => {
                completeStep(1);
            }, 100);
        }
        
        function selectCellById(col, row) {
            console.log(`🎯 Selecting cell ${col}${row}...`);
            
            // Clear previous selection
            document.querySelectorAll('.excel-grid td.selected').forEach(cell => {
                cell.classList.remove('selected');
            });
            
            // Select new cell
            const cell = document.getElementById(`${col}${row}`);
            if (cell) {
                cell.classList.add('selected');
                selectedCell = { col, row };
                document.getElementById('cell-ref').textContent = `${col}${row}`;
                
                console.log(`✅ Selected cell ${col}${row}, current step: ${currentStep}`);
                
                // Check step completion
                if (currentStep === 2 && col === 'E' && row === 2) {
                    console.log('✅ Step 2 condition met - E2 selected');
                    setTimeout(() => completeStep(2), 100);
                } else if (currentStep === 10 && col === 'D' && row === 2) {
                    console.log('✅ Step 10 condition met - D2 selected');
                    setTimeout(() => completeStep(10), 100);
                }
            } else {
                console.error(`❌ Cell ${col}${row} not found!`);
            }
        }
        
        function selectCell(col, row) {
            selectCellById(col, row);
        }
        
        function startVLOOKUP() {
            console.log('🔧 Starting VLOOKUP...');
            const formulaInput = document.getElementById('formula-input');
            formulaInput.value = '=VLOOKUP(';
            formulaInput.focus();
            formulaSteps.vlookup = true;
            
            setTimeout(() => completeStep(3), 100);
        }
        
        function addLookupValue() {
            console.log('🔧 Adding lookup value...');
            const formulaInput = document.getElementById('formula-input');
            formulaInput.value = '=VLOOKUP(D2,';
            formulaSteps.lookupValue = true;
            
            setTimeout(() => completeStep(4), 100);
        }
        
        function addTableArray() {
            console.log('🔧 Adding table array...');
            const formulaInput = document.getElementById('formula-input');
            formulaInput.value = '=VLOOKUP(D2,A2:B6,';
            formulaSteps.tableArray = true;
            
            setTimeout(() => completeStep(5), 100);
        }
        
        function addColumnIndex() {
            console.log('🔧 Adding column index...');
            const formulaInput = document.getElementById('formula-input');
            formulaInput.value = '=VLOOKUP(D2,A2:B6,2,';
            formulaSteps.columnIndex = true;
            
            setTimeout(() => completeStep(6), 100);
        }
        
        function addExactMatch() {
            console.log('🔧 Adding exact match...');
            const formulaInput = document.getElementById('formula-input');
            formulaInput.value = '=VLOOKUP(D2,A2:B6,2,FALSE)';
            formulaSteps.exactMatch = true;
            
            setTimeout(() => completeStep(7), 100);
        }
        
        function executeFormula() {
            console.log('⚡ Executing formula...');
            
            if (selectedCell && selectedCell.col === 'E' && selectedCell.row === 2) {
                const d2Cell = document.getElementById('D2');
                const e2Cell = document.getElementById('E2');
                const lookupValue = d2Cell.textContent;
                const result = employeeData[lookupValue] || '#N/A';
                
                console.log(`Looking up: "${lookupValue}" -> "${result}"`);
                
                e2Cell.textContent = result;
                e2Cell.style.background = '#dcfce7';
                e2Cell.style.fontWeight = 'bold';
                
                // Highlight relevant cells
                highlightCells(['D2', 'E2'], '#fef3c7');
                
                formulaSteps.executed = true;
                
                setTimeout(() => completeStep(8), 100);
            } else {
                console.error('❌ Cannot execute - E2 not selected or invalid cell');
                alert('Please select cell E2 first!');
            }
        }
        
        function understandResult() {
            console.log('🧠 Understanding result...');
            
            setTimeout(() => {
                completeStep(9);
                // Enable next step after understanding
                setTimeout(() => {
                    const nextStepBtn = document.getElementById('step-10-btn');
                    if (nextStepBtn) nextStepBtn.disabled = false;
                    const nextStepCard = document.getElementById('step-10');
                    if (nextStepCard) nextStepCard.classList.add('active');
                }, 200);
            }, 100);
        }
        
        function tryDifferentValues() {
            console.log('🔄 Trying different values...');
            
            // Automatically change D2 to "101" and update result
            const d2Cell = document.getElementById('D2');
            const e2Cell = document.getElementById('E2');
            
            d2Cell.textContent = '101';
            e2Cell.textContent = 'John Smith';
            e2Cell.style.background = '#dcfce7';
            e2Cell.style.fontWeight = 'bold';
            
            // Highlight the cells
            d2Cell.style.background = '#e0f2fe';
            d2Cell.style.border = '2px solid #1a73e8';
            
            selectCellById('D', 2);
            
            setTimeout(() => completeStep(10), 100);
        }
        
        function testEdgeCases() {
            console.log('❌ Testing edge cases...');
            
            const d2Cell = document.getElementById('D2');
            const e2Cell = document.getElementById('E2');
            
            d2Cell.textContent = '999';
            e2Cell.textContent = '#N/A';
            e2Cell.style.background = '#fee2e2';
            e2Cell.style.color = '#dc2626';
            
            setTimeout(() => completeStep(11), 100);
        }
        
        function highlightCells(cellIds, color) {
            cellIds.forEach(cellId => {
                const cell = document.getElementById(cellId);
                if (cell) {
                    cell.style.background = color;
                }
            });
        }
        
        function completeStep(stepNumber) {
            console.log(`🎯 Completing step ${stepNumber}...`);
            
            // Find step elements
            const stepCard = document.getElementById(`step-${stepNumber}`);
            const stepNumber_el = stepCard ? stepCard.querySelector('.step-number') : null;
            const completionMessage = document.getElementById(`step-${stepNumber}-complete`);
            
            if (!stepCard) {
                console.error(`❌ Step ${stepNumber} card not found!`);
                return;
            }
            
            // Mark step as completed
            stepCard.classList.add('completed');
            if (stepNumber_el) stepNumber_el.classList.add('completed');
            if (completionMessage) completionMessage.classList.add('show');
            
            // Update current step to be at least this step + 1
            currentStep = Math.max(currentStep, stepNumber + 1);
            
            // Enable next step if it exists
            if (stepNumber < 12) {
                const nextStepBtn = document.getElementById(`step-${stepNumber + 1}-btn`);
                const nextStepCard = document.getElementById(`step-${stepNumber + 1}`);
                
                if (nextStepBtn) {
                    nextStepBtn.disabled = false;
                    console.log(`✅ Step ${stepNumber + 1} button enabled`);
                }
                if (nextStepCard) {
                    nextStepCard.classList.add('active');
                    console.log(`✅ Step ${stepNumber + 1} card activated`);
                }
            }
            
            updateProgress();
            console.log(`✅ Step ${stepNumber} completed! Current step: ${currentStep}`);
        }
        
        function updateProgress() {
            const progressPercent = Math.min(Math.floor(((currentStep - 1) / 12) * 100), 100);
            document.getElementById('progress-fill').style.width = `${progressPercent}%`;
            
            if (currentStep > 12) {
                document.getElementById('progress-text').textContent = `100% Complete - VLOOKUP Master!`;
            } else {
                document.getElementById('progress-text').textContent = `${progressPercent}% Complete (Step ${currentStep} of 12)`;
            }
        }
        
        function restartTutorial() {
            currentStep = 1;
            selectedCell = null;
            hasData = false;
            formulaSteps = {
                vlookup: false,
                lookupValue: false,
                tableArray: false,
                columnIndex: false,
                exactMatch: false,
                executed: false
            };
            
            // Reset UI
            document.querySelectorAll('.step-card').forEach(card => {
                card.classList.remove('active', 'completed');
            });
            document.getElementById('step-1').classList.add('active');
            
            document.querySelectorAll('.step-number').forEach(num => {
                num.classList.remove('completed');
            });
            
            document.querySelectorAll('.completion-message').forEach(msg => {
                msg.classList.remove('show');
            });
            
            document.querySelectorAll('.step-action').forEach(btn => {
                btn.disabled = true;
            });
            document.getElementById('step-1-btn').disabled = false;
            
            // Clear Excel data
            initializeGrid();
            document.getElementById('formula-input').value = '';
            document.getElementById('cell-ref').textContent = 'A1';
            
            updateProgress();
        }
        
        // Handle formula input changes - allow typing
        document.getElementById('formula-input').addEventListener('input', function(e) {
            const value = e.target.value.toUpperCase();
            console.log('📝 Formula input changed:', value, 'Current step:', currentStep);
            
            // Check what step this formula represents and auto-complete previous steps
            if (value === '=VLOOKUP(' && currentStep <= 3) {
                console.log('✅ Detected VLOOKUP start, completing step 3');
                setTimeout(() => completeStep(3), 50);
            } else if (value === '=VLOOKUP(D2,' && currentStep <= 4) {
                console.log('✅ Detected lookup value, completing steps 3-4');
                if (currentStep <= 3) setTimeout(() => completeStep(3), 50);
                setTimeout(() => completeStep(4), 100);
            } else if (value === '=VLOOKUP(D2,A2:B6,' && currentStep <= 5) {
                console.log('✅ Detected table array, completing steps 3-5');
                if (currentStep <= 3) setTimeout(() => completeStep(3), 50);
                if (currentStep <= 4) setTimeout(() => completeStep(4), 100);
                setTimeout(() => completeStep(5), 150);
            } else if (value === '=VLOOKUP(D2,A2:B6,2,' && currentStep <= 6) {
                console.log('✅ Detected column index, completing steps 3-6');
                if (currentStep <= 3) setTimeout(() => completeStep(3), 50);
                if (currentStep <= 4) setTimeout(() => completeStep(4), 100);
                if (currentStep <= 5) setTimeout(() => completeStep(5), 150);
                setTimeout(() => completeStep(6), 200);
            } else if (value === '=VLOOKUP(D2,A2:B6,2,FALSE)' && currentStep <= 7) {
                console.log('✅ Detected complete formula, completing steps 3-7');
                if (currentStep <= 3) setTimeout(() => completeStep(3), 50);
                if (currentStep <= 4) setTimeout(() => completeStep(4), 100);
                if (currentStep <= 5) setTimeout(() => completeStep(5), 150);
                if (currentStep <= 6) setTimeout(() => completeStep(6), 200);
                setTimeout(() => completeStep(7), 250);
            }
        });
        
        // Handle Enter key in formula input
        document.getElementById('formula-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const value = e.target.value.toUpperCase();
                
                // If they have the complete formula, execute it
                if (value === '=VLOOKUP(D2,A2:B6,2,FALSE)' && currentStep >= 8) {
                    executeFormula();
                }
                // If they have a partial formula, advance to next logical step
                else if (value.includes('=VLOOKUP(') && currentStep >= 3) {
                    // Try to determine which step they should be on based on formula content
                    if (value.includes('FALSE)')) {
                        // Complete formula - go to execute step
                        if (currentStep < 8) {
                            // Auto-complete intermediate steps
                            for (let i = currentStep; i < 8; i++) {
                                completeStep(i);
                            }
                        }
                    } else if (value.includes(',2,')) {
                        // Has column index, go to exact match step
                        if (currentStep < 7) completeStep(6);
                    } else if (value.includes('A2:B6,')) {
                        // Has table array, go to column index step  
                        if (currentStep < 6) completeStep(5);
                    } else if (value.includes('D2,')) {
                        // Has lookup value, go to table array step
                        if (currentStep < 5) completeStep(4);
                    } else if (value.includes('=VLOOKUP(')) {
                        // Just has VLOOKUP, go to lookup value step
                        if (currentStep < 4) completeStep(3);
                    }
                }
            }
        });
        
        // Handle cell editing for trying different values
        document.addEventListener('click', function(e) {
            if (e.target.id === 'D2' && currentStep >= 10) {
                const cell = e.target;
                const oldValue = cell.textContent;
                
                // Make cell editable
                cell.contentEditable = true;
                cell.focus();
                
                cell.addEventListener('blur', function() {
                    cell.contentEditable = false;
                    const newValue = cell.textContent;
                    
                    if (newValue !== oldValue) {
                        // Update E2 with new lookup result
                        const e2Cell = document.getElementById('E2');
                        const result = employeeData[newValue] || '#N/A';
                        e2Cell.textContent = result;
                        
                        if (result === '#N/A') {
                            e2Cell.style.background = '#fee2e2';
                            e2Cell.style.color = '#dc2626';
                            
                            // Check if we should complete step 11 (testing edge cases)
                            if (newValue === '999' && currentStep === 11) {
                                completeStep(11);
                            }
                        } else {
                            e2Cell.style.background = '#dcfce7';
                            e2Cell.style.color = '#000';
                            
                            // Auto-complete step 10 if they entered a valid different ID
                            if (currentStep === 10 && newValue !== '103' && employeeData[newValue]) {
                                completeStep(10);
                            }
                        }
                    }
                });
                
                cell.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        cell.blur();
                    }
                });
            }
        });
        
        // Initialize on load
        initializeGrid();
        updateProgress();
    </script>
</body>
</html>
